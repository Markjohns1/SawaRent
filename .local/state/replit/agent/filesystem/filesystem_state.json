{"file_contents":{"frontend/src/services/api.js":{"content":"import axios from 'axios'\n\nconst api = axios.create({\n  baseURL: '/api',\n  withCredentials: true,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n})\n\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      window.location.href = '/login'\n    }\n    return Promise.reject(error)\n  }\n)\n\nexport default api\n","size_bytes":377},"backend/app/models/alert.py":{"content":"from app import db\nfrom datetime import datetime\nimport pytz\n\nclass Alert(db.Model):\n    __tablename__ = 'alerts'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    alert_type = db.Column(db.String(50), nullable=False)\n    message = db.Column(db.Text, nullable=False)\n    severity = db.Column(db.String(20), default='info')\n    is_read = db.Column(db.Boolean, default=False)\n    related_tenant_id = db.Column(db.Integer, db.ForeignKey('tenants.id'))\n    related_payment_id = db.Column(db.Integer, db.ForeignKey('payments.id'))\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'alert_type': self.alert_type,\n            'message': self.message,\n            'severity': self.severity,\n            'is_read': self.is_read,\n            'related_tenant_id': self.related_tenant_id,\n            'related_payment_id': self.related_payment_id,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":1074},"backend/run.py":{"content":"from app import create_app, db\nfrom app.models.user import User\nfrom app.models.tenant import Tenant\nfrom app.models.payment import Payment\nfrom app.models.template import Template\nfrom app.models.sms_log import SMSLog\nfrom app.models.alert import Alert\nimport os\n\napp = create_app(os.getenv('FLASK_ENV', 'development'))\n\n@app.shell_context_processor\ndef make_shell_context():\n    return {\n        'db': db,\n        'User': User,\n        'Tenant': Tenant,\n        'Payment': Payment,\n        'Template': Template,\n        'SMSLog': SMSLog,\n        'Alert': Alert\n    }\n\nif __name__ == '__main__':\n    with app.app_context():\n        db.create_all()\n    \n    app.run(host='0.0.0.0', port=8000, debug=True)\n","size_bytes":705},"backend/app/utils/decorators.py":{"content":"from functools import wraps\nfrom flask import jsonify\nfrom flask_login import current_user\n\ndef role_required(*roles):\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            if not current_user.is_authenticated:\n                return jsonify({'error': 'Authentication required'}), 401\n            \n            if current_user.role not in roles:\n                return jsonify({'error': 'Insufficient permissions'}), 403\n            \n            return f(*args, **kwargs)\n        return decorated_function\n    return decorator\n\ndef admin_required(f):\n    return role_required('super_admin')(f)\n\ndef admin_or_caretaker_required(f):\n    return role_required('super_admin', 'caretaker')(f)\n","size_bytes":733},"backend_backup_20251109_155046/run.py":{"content":"from app import create_app, db\nfrom app.models.user import User\nfrom app.models.tenant import Tenant\nfrom app.models.payment import Payment\nfrom app.models.template import Template\nfrom app.models.sms_log import SMSLog\nfrom app.models.alert import Alert\nimport os\n\napp = create_app(os.getenv('FLASK_ENV', 'development'))\n\n@app.shell_context_processor\ndef make_shell_context():\n    return {\n        'db': db,\n        'User': User,\n        'Tenant': Tenant,\n        'Payment': Payment,\n        'Template': Template,\n        'SMSLog': SMSLog,\n        'Alert': Alert\n    }\n\nif __name__ == '__main__':\n    with app.app_context():\n        db.create_all()\n    \n    app.run(host='0.0.0.0', port=8000, debug=True)\n","size_bytes":705},"frontend/src/components/Layout.jsx":{"content":"import { Link, useLocation } from 'react-router-dom'\nimport ThemeToggle from './ThemeToggle'\nimport { useTheme } from '../context/ThemeContext'\n\nexport default function Layout({ user, onLogout, children }) {\n  const location = useLocation()\n  const { theme } = useTheme()\n\n  const isActive = (path) => location.pathname === path\n\n  return (\n    <div className=\"min-h-screen transition-colors duration-300\" style={{ backgroundColor: 'var(--theme-background)' }}>\n      <nav className=\"theme-card mb-0\" style={{ borderRadius: '0', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between h-16\">\n            <div className=\"flex space-x-1 md:space-x-4\">\n              <Link\n                to=\"/\"\n                className={`inline-flex items-center px-3 py-2 text-sm font-medium transition-all duration-200 ${\n                  isActive('/')\n                    ? theme === 'friendly'\n                      ? 'text-friendly-primary border-b-4 border-friendly-primary'\n                      : 'text-formal-primary border-b-4 border-formal-primary'\n                    : 'text-gray-600 hover:text-gray-900'\n                }`}\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\n                </svg>\n                <span className=\"hidden md:inline\">Dashboard</span>\n              </Link>\n              <Link\n                to=\"/tenants\"\n                className={`inline-flex items-center px-3 py-2 text-sm font-medium transition-all duration-200 ${\n                  isActive('/tenants')\n                    ? theme === 'friendly'\n                      ? 'text-friendly-primary border-b-4 border-friendly-primary'\n                      : 'text-formal-primary border-b-4 border-formal-primary'\n                    : 'text-gray-600 hover:text-gray-900'\n                }`}\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n                <span className=\"hidden md:inline\">Tenants</span>\n              </Link>\n              <Link\n                to=\"/payments\"\n                className={`inline-flex items-center px-3 py-2 text-sm font-medium transition-all duration-200 ${\n                  isActive('/payments')\n                    ? theme === 'friendly'\n                      ? 'text-friendly-primary border-b-4 border-friendly-primary'\n                      : 'text-formal-primary border-b-4 border-formal-primary'\n                    : 'text-gray-600 hover:text-gray-900'\n                }`}\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n                <span className=\"hidden md:inline\">Payments</span>\n              </Link>\n              <Link\n                to=\"/messaging\"\n                className={`inline-flex items-center px-3 py-2 text-sm font-medium transition-all duration-200 ${\n                  isActive('/messaging')\n                    ? theme === 'friendly'\n                      ? 'text-friendly-primary border-b-4 border-friendly-primary'\n                      : 'text-formal-primary border-b-4 border-formal-primary'\n                    : 'text-gray-600 hover:text-gray-900'\n                }`}\n              >\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\n                </svg>\n                <span className=\"hidden md:inline\">Messaging</span>\n              </Link>\n              {user.role === 'super_admin' && (\n                <Link\n                  to=\"/users\"\n                  className={`inline-flex items-center px-3 py-2 text-sm font-medium transition-all duration-200 ${\n                    isActive('/users')\n                      ? theme === 'friendly'\n                        ? 'text-friendly-primary border-b-4 border-friendly-primary'\n                        : 'text-formal-primary border-b-4 border-formal-primary'\n                      : 'text-gray-600 hover:text-gray-900'\n                  }`}\n                >\n                  <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\n                  </svg>\n                  <span className=\"hidden md:inline\">Users</span>\n                </Link>\n              )}\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              <ThemeToggle />\n              <div className=\"hidden md:flex items-center space-x-3 border-l pl-3\" style={{ borderColor: 'var(--theme-text-secondary)' }}>\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"h-8 w-8 rounded-full flex items-center justify-center text-white font-semibold\" style={{ backgroundColor: 'var(--theme-primary)' }}>\n                    {(user.full_name || user.username).charAt(0).toUpperCase()}\n                  </div>\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm font-medium\" style={{ color: 'var(--theme-text)' }}>{user.full_name || user.username}</span>\n                    <span className=\"text-xs\" style={{ color: 'var(--theme-text-secondary)' }}>{user.role}</span>\n                  </div>\n                </div>\n                <button\n                  onClick={onLogout}\n                  className=\"text-sm px-3 py-1.5 rounded transition-colors duration-200\"\n                  style={{\n                    backgroundColor: theme === 'friendly' ? '#fed7aa' : '#e2e8f0',\n                    color: 'var(--theme-text)',\n                    borderRadius: 'var(--theme-radius)',\n                  }}\n                >\n                  Logout\n                </button>\n              </div>\n              <button\n                onClick={onLogout}\n                className=\"md:hidden text-sm px-2 py-1 rounded\"\n                style={{\n                  backgroundColor: theme === 'friendly' ? '#fed7aa' : '#e2e8f0',\n                  color: 'var(--theme-text)',\n                }}\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n                </svg>\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {children}\n      </main>\n    </div>\n  )\n}\n","size_bytes":7858},"backend/app/routes/dashboard_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required\nfrom app import db\nfrom app.models.tenant import Tenant\nfrom app.models.payment import Payment\nfrom app.models.alert import Alert\nfrom app.utils.decorators import admin_or_caretaker_required\nfrom datetime import datetime, timedelta\nfrom sqlalchemy import func\nimport pytz\n\nbp = Blueprint('dashboard', __name__, url_prefix='/api/dashboard')\n\n@bp.route('/summary', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_summary():\n    tz = pytz.timezone('Africa/Nairobi')\n    current_month = datetime.now(tz).month\n    current_year = datetime.now(tz).year\n    \n    tenants = Tenant.query.filter_by(is_active=True).all()\n    total_tenants = len(tenants)\n    total_expected = sum([t.expected_rent for t in tenants])\n    \n    payments_this_month = Payment.query.filter(\n        func.extract('month', Payment.payment_date) == current_month,\n        func.extract('year', Payment.payment_date) == current_year\n    ).all()\n    \n    total_collected = sum([p.amount for p in payments_this_month])\n    \n    paid_tenants = []\n    partial_tenants = []\n    overdue_tenants = []\n    \n    for tenant in tenants:\n        tenant_payments = [p for p in payments_this_month if p.tenant_id == tenant.id]\n        total_paid = sum([p.amount for p in tenant_payments])\n        \n        if total_paid >= tenant.expected_rent:\n            paid_tenants.append(tenant.id)\n        elif total_paid > 0:\n            partial_tenants.append({\n                'tenant_id': tenant.id,\n                'tenant_name': tenant.full_name,\n                'unit_number': tenant.unit_number,\n                'expected_rent': tenant.expected_rent,\n                'paid_amount': total_paid,\n                'remaining_amount': tenant.expected_rent - total_paid\n            })\n        else:\n            overdue_tenants.append({\n                'tenant_id': tenant.id,\n                'tenant_name': tenant.full_name,\n                'unit_number': tenant.unit_number,\n                'expected_rent': tenant.expected_rent\n            })\n    \n    return jsonify({\n        'total_tenants': total_tenants,\n        'total_expected': total_expected,\n        'total_collected': total_collected,\n        'paid_count': len(paid_tenants),\n        'partial_count': len(partial_tenants),\n        'overdue_count': len(overdue_tenants),\n        'partial_tenants': partial_tenants,\n        'overdue_tenants': overdue_tenants\n    }), 200\n\n@bp.route('/alerts', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_alerts():\n    unread_only = request.args.get('unread_only', 'false').lower() == 'true'\n    \n    query = Alert.query.order_by(Alert.created_at.desc())\n    if unread_only:\n        query = query.filter_by(is_read=False)\n    \n    alerts = query.limit(50).all()\n    return jsonify({'alerts': [a.to_dict() for a in alerts]}), 200\n\n@bp.route('/alerts/<int:alert_id>/mark-read', methods=['PUT'])\n@login_required\n@admin_or_caretaker_required\ndef mark_alert_read(alert_id):\n    alert = Alert.query.get_or_404(alert_id)\n    alert.is_read = True\n    db.session.commit()\n    \n    return jsonify({'message': 'Alert marked as read'}), 200\n\n@bp.route('/lease-expiring', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_expiring_leases():\n    tz = pytz.timezone('Africa/Nairobi')\n    today = datetime.now(tz).date()\n    thirty_days = today + timedelta(days=30)\n    \n    expiring_tenants = Tenant.query.filter(\n        Tenant.is_active == True,\n        Tenant.lease_end_date <= thirty_days,\n        Tenant.lease_end_date >= today\n    ).all()\n    \n    return jsonify({\n        'expiring_leases': [\n            {\n                **t.to_dict(),\n                'days_remaining': (t.lease_end_date - today).days\n            } for t in expiring_tenants\n        ]\n    }), 200\n","size_bytes":3843},"frontend/src/pages/Dashboard.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Dashboard() {\n  const [summary, setSummary] = useState(null)\n  const [alerts, setAlerts] = useState([])\n  const [loading, setLoading] = useState(true)\n  const { theme } = useTheme()\n\n  useEffect(() => {\n    fetchDashboardData()\n  }, [])\n\n  const fetchDashboardData = async () => {\n    try {\n      const [summaryRes, alertsRes] = await Promise.all([\n        api.get('/dashboard/summary'),\n        api.get('/dashboard/alerts?unread_only=true'),\n      ])\n      setSummary(summaryRes.data)\n      setAlerts(alertsRes.data.alerts)\n    } catch (error) {\n      console.error('Failed to fetch dashboard data:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2\" style={{ borderColor: 'var(--theme-primary)' }}></div>\n      </div>\n    )\n  }\n\n  const StatCard = ({ title, value, color }) => (\n    <div className=\"theme-card p-6 hover:scale-105 transition-transform duration-200\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <div className=\"text-sm font-medium\" style={{ color: 'var(--theme-text-secondary)' }}>{title}</div>\n          <div className=\"mt-2 text-3xl font-bold\" style={{ color: color || 'var(--theme-text)' }}>\n            {value}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n\n  const StatusCard = ({ title, count, bgColor, textColor }) => (\n    <div \n      className=\"p-6 border-2 transition-all duration-200 hover:scale-105\"\n      style={{ \n        backgroundColor: `${bgColor}15`,\n        borderColor: bgColor,\n        borderRadius: 'var(--theme-radius)'\n      }}\n    >\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <div className=\"text-sm font-medium\" style={{ color: textColor }}>{title}</div>\n          <div className=\"mt-2 text-3xl font-bold\" style={{ color: textColor }}>{count}</div>\n        </div>\n      </div>\n    </div>\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-3xl font-bold\" style={{ color: 'var(--theme-text)' }}>\n          Property Dashboard\n        </h1>\n        <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>\n          {new Date().toLocaleDateString('en-KE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Total Tenants\"\n          value={summary?.total_tenants || 0}\n        />\n        <StatCard\n          title=\"Expected Rent\"\n          value={`KES ${(summary?.total_expected || 0).toLocaleString()}`}\n        />\n        <StatCard\n          title=\"Collected\"\n          value={`KES ${(summary?.total_collected || 0).toLocaleString()}`}\n          color={theme === 'friendly' ? '#34d399' : '#059669'}\n        />\n        <StatCard\n          title=\"Outstanding\"\n          value={`KES ${((summary?.total_expected || 0) - (summary?.total_collected || 0)).toLocaleString()}`}\n          color={theme === 'friendly' ? '#f87171' : '#dc2626'}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <StatusCard\n          title=\"Paid\"\n          count={summary?.paid_count || 0}\n          bgColor={theme === 'friendly' ? '#34d399' : '#059669'}\n          textColor={theme === 'friendly' ? '#065f46' : '#064e3b'}\n        />\n        <StatusCard\n          title=\"Partial\"\n          count={summary?.partial_count || 0}\n          bgColor={theme === 'friendly' ? '#fbbf24' : '#d97706'}\n          textColor={theme === 'friendly' ? '#92400e' : '#78350f'}\n        />\n        <StatusCard\n          title=\"Overdue\"\n          count={summary?.overdue_count || 0}\n          bgColor={theme === 'friendly' ? '#f87171' : '#dc2626'}\n          textColor={theme === 'friendly' ? '#991b1b' : '#7f1d1d'}\n        />\n      </div>\n\n      {summary?.partial_tenants && summary.partial_tenants.length > 0 && (\n        <div className=\"theme-card\">\n          <div className=\"px-6 py-4 border-b\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            <h2 className=\"text-lg font-semibold\" style={{ color: 'var(--theme-text)' }}>\n              Partial Payments\n            </h2>\n          </div>\n          <div className=\"divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            {summary.partial_tenants.map((tenant) => (\n              <div key={tenant.tenant_id} className=\"px-6 py-4 flex justify-between items-center hover:bg-gray-50 transition-colors\">\n                <div>\n                  <div className=\"font-medium\" style={{ color: 'var(--theme-text)' }}>{tenant.tenant_name}</div>\n                  <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>Unit {tenant.unit_number}</div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>\n                    Paid: KES {tenant.paid_amount?.toLocaleString()}\n                  </div>\n                  <div className=\"text-sm font-semibold\" style={{ color: theme === 'friendly' ? '#fbbf24' : '#d97706' }}>\n                    Remaining: KES {tenant.remaining_amount?.toLocaleString()}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {summary?.overdue_tenants && summary.overdue_tenants.length > 0 && (\n        <div className=\"theme-card\">\n          <div className=\"px-6 py-4 border-b\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            <h2 className=\"text-lg font-semibold\" style={{ color: 'var(--theme-text)' }}>\n              Overdue Payments\n            </h2>\n          </div>\n          <div className=\"divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            {summary.overdue_tenants.map((tenant) => (\n              <div key={tenant.tenant_id} className=\"px-6 py-4 flex justify-between items-center hover:bg-gray-50 transition-colors\">\n                <div>\n                  <div className=\"font-medium\" style={{ color: 'var(--theme-text)' }}>{tenant.tenant_name}</div>\n                  <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>Unit {tenant.unit_number}</div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-sm font-semibold\" style={{ color: theme === 'friendly' ? '#f87171' : '#dc2626' }}>\n                    Due: KES {tenant.expected_rent?.toLocaleString()}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {alerts.length > 0 && (\n        <div className=\"theme-card\">\n          <div className=\"px-6 py-4 border-b\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            <h2 className=\"text-lg font-semibold\" style={{ color: 'var(--theme-text)' }}>\n              Recent Alerts\n            </h2>\n          </div>\n          <div className=\"divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            {alerts.slice(0, 5).map((alert) => (\n              <div key={alert.id} className=\"px-6 py-3 hover:bg-gray-50 transition-colors\">\n                <div className=\"flex items-start space-x-3\">\n                  <div className=\"flex-1\">\n                    <div className=\"text-sm\" style={{ color: 'var(--theme-text)' }}>{alert.message}</div>\n                    <div className=\"text-xs mt-1\" style={{ color: 'var(--theme-text-secondary)' }}>\n                      {new Date(alert.created_at).toLocaleString()}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":8032},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"email-validator>=2.3.0\",\n    \"flask>=3.1.2\",\n    \"flask-cors>=6.0.1\",\n    \"flask-login>=0.6.3\",\n    \"flask-sqlalchemy>=3.1.1\",\n    \"gunicorn>=23.0.0\",\n    \"psycopg2-binary>=2.9.11\",\n    \"python-dotenv>=1.2.1\",\n    \"pytz>=2025.2\",\n    \"requests>=2.32.5\",\n    \"twilio>=9.8.5\",\n    \"werkzeug>=3.1.3\",\n]\n","size_bytes":447},"backend/app/__init__.py":{"content":"from flask import Flask\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_login import LoginManager\nfrom flask_cors import CORS\nfrom config import config\nimport os\n\ndb = SQLAlchemy()\nlogin_manager = LoginManager()\n\n@login_manager.user_loader\ndef load_user(user_id):\n    from app.models.user import User\n    user = User.query.get(int(user_id))\n    if user and not user.is_active:\n        return None\n    return user\n\ndef create_app(config_name='default'):\n    app = Flask(__name__)\n    app.config.from_object(config[config_name])\n    \n    CORS(app, supports_credentials=True)\n    \n    db.init_app(app)\n    login_manager.init_app(app)\n    login_manager.login_view = 'auth.login'\n    \n    with app.app_context():\n        from app.models import user, tenant, payment, template, sms_log, alert\n        \n        from app.routes import auth_routes, tenant_routes, payment_routes, dashboard_routes, messaging_routes, mpesa_routes\n        \n        app.register_blueprint(auth_routes.bp)\n        app.register_blueprint(tenant_routes.bp)\n        app.register_blueprint(payment_routes.bp)\n        app.register_blueprint(dashboard_routes.bp)\n        app.register_blueprint(messaging_routes.bp)\n        app.register_blueprint(mpesa_routes.bp)\n        \n        db.create_all()\n    \n    return app\n","size_bytes":1283},"frontend/postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"backend/app/models/tenant.py":{"content":"from app import db\nfrom datetime import datetime\nimport pytz\n\nclass Tenant(db.Model):\n    __tablename__ = 'tenants'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    full_name = db.Column(db.String(120), nullable=False)\n    phone = db.Column(db.String(20), nullable=False)\n    email = db.Column(db.String(120))\n    unit_number = db.Column(db.String(20), nullable=False)\n    expected_rent = db.Column(db.Float, nullable=False)\n    deposit_amount = db.Column(db.Float, default=0.0)\n    lease_start_date = db.Column(db.Date, nullable=False)\n    lease_end_date = db.Column(db.Date, nullable=False)\n    is_active = db.Column(db.Boolean, default=True)\n    notes = db.Column(db.Text)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')), onupdate=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    payments = db.relationship('Payment', backref='tenant', lazy=True, cascade='all, delete-orphan')\n    \n    def get_initials(self):\n        parts = self.full_name.split()\n        return ''.join([p[0].upper() for p in parts if p])\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'full_name': self.full_name,\n            'phone': self.phone,\n            'email': self.email,\n            'unit_number': self.unit_number,\n            'expected_rent': self.expected_rent,\n            'deposit_amount': self.deposit_amount,\n            'lease_start_date': self.lease_start_date.isoformat() if self.lease_start_date else None,\n            'lease_end_date': self.lease_end_date.isoformat() if self.lease_end_date else None,\n            'is_active': self.is_active,\n            'notes': self.notes,\n            'initials': self.get_initials(),\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":1926},"backend_backup_20251109_155046/messaging_service.py":{"content":"from flask import current_app\nfrom app.models.template import Template\nfrom app import db\n\nclass MessagingService:\n    def __init__(self):\n        self.provider = current_app.config.get('SMS_PROVIDER', 'twilio')\n    \n    def send_sms(self, phone, message, recipient_name=''):\n        if self.provider == 'twilio':\n            return self._send_via_twilio(phone, message)\n        else:\n            current_app.logger.info(f'SMS to {phone} ({recipient_name}): {message}')\n            return True\n    \n    def _send_via_twilio(self, phone, message):\n        try:\n            from twilio.rest import Client\n            \n            account_sid = current_app.config.get('TWILIO_ACCOUNT_SID')\n            auth_token = current_app.config.get('TWILIO_AUTH_TOKEN')\n            from_phone = current_app.config.get('TWILIO_PHONE_NUMBER')\n            \n            if not all([account_sid, auth_token, from_phone]):\n                current_app.logger.warning('Twilio credentials not configured. SMS not sent.')\n                return False\n            \n            client = Client(account_sid, auth_token)\n            \n            message = client.messages.create(\n                body=message,\n                from_=from_phone,\n                to=phone\n            )\n            \n            return True\n        except Exception as e:\n            current_app.logger.error(f'Failed to send SMS via Twilio: {str(e)}')\n            return False\n    \n    def send_payment_receipt(self, payment, tenant):\n        template = Template.query.filter_by(\n            category='receipt',\n            theme='formal',\n            is_active=True\n        ).first()\n        \n        if template:\n            message = template.render(\n                tenant_name=tenant.full_name,\n                unit_number=tenant.unit_number,\n                amount=payment.amount,\n                payment_date=payment.payment_date.strftime('%d/%m/%Y'),\n                remaining_amount=payment.remaining_amount,\n                transaction_reference=payment.transaction_reference or 'N/A'\n            )\n        else:\n            message = f'Receipt: Payment of KES {payment.amount} received for Unit {tenant.unit_number} on {payment.payment_date.strftime(\"%d/%m/%Y\")}.'\n            if payment.remaining_amount > 0:\n                message += f' Remaining balance: KES {payment.remaining_amount}.'\n        \n        return self.send_sms(tenant.phone, message, tenant.full_name)\n    \n    def send_rent_reminder(self, tenant, remaining_amount=None):\n        template = Template.query.filter_by(\n            category='reminder',\n            is_active=True\n        ).first()\n        \n        if template:\n            message = template.render(\n                tenant_name=tenant.full_name,\n                unit_number=tenant.unit_number,\n                remaining_amount=remaining_amount or tenant.expected_rent\n            )\n        else:\n            message = f'Reminder: Rent of KES {remaining_amount or tenant.expected_rent} is due for Unit {tenant.unit_number}.'\n        \n        return self.send_sms(tenant.phone, message, tenant.full_name)\n","size_bytes":3099},"backend/app/models/payment.py":{"content":"from app import db\nfrom datetime import datetime\nimport pytz\n\nclass Payment(db.Model):\n    __tablename__ = 'payments'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    tenant_id = db.Column(db.Integer, db.ForeignKey('tenants.id'), nullable=False)\n    amount = db.Column(db.Float, nullable=False)\n    payment_date = db.Column(db.Date, nullable=False)\n    payment_method = db.Column(db.String(20), nullable=False)\n    payment_status = db.Column(db.String(20), nullable=False)\n    transaction_reference = db.Column(db.String(100))\n    remaining_amount = db.Column(db.Float, default=0.0)\n    notes = db.Column(db.Text)\n    logged_by = db.Column(db.Integer, db.ForeignKey('users.id'))\n    receipt_sent = db.Column(db.Boolean, default=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')), onupdate=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    def calculate_status(self, expected_rent):\n        if self.amount >= expected_rent:\n            self.payment_status = 'Full'\n            self.remaining_amount = 0.0\n        else:\n            self.payment_status = 'Partial'\n            self.remaining_amount = expected_rent - self.amount\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'tenant_id': self.tenant_id,\n            'amount': self.amount,\n            'payment_date': self.payment_date.isoformat() if self.payment_date else None,\n            'payment_method': self.payment_method,\n            'payment_status': self.payment_status,\n            'transaction_reference': self.transaction_reference,\n            'remaining_amount': self.remaining_amount,\n            'notes': self.notes,\n            'logged_by': self.logged_by,\n            'receipt_sent': self.receipt_sent,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":1984},"backend/config.py":{"content":"import os\nfrom datetime import timedelta\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nbasedir = os.path.abspath(os.path.dirname(__file__))\n\nclass Config:\n    SECRET_KEY = os.getenv('SESSION_SECRET', 'dev-secret-key-change-in-production')\n    SQLALCHEMY_DATABASE_URI = os.getenv('DATABASE_URL')\n    SQLALCHEMY_TRACK_MODIFICATIONS = False\n    SQLALCHEMY_ENGINE_OPTIONS = {\n        \"pool_recycle\": 300,\n        \"pool_pre_ping\": True,\n    }\n    \n    TIMEZONE = os.getenv('TIMEZONE', 'Africa/Nairobi')\n    \n    SESSION_COOKIE_SECURE = False\n    SESSION_COOKIE_HTTPONLY = True\n    SESSION_COOKIE_SAMESITE = 'Lax'\n    PERMANENT_SESSION_LIFETIME = timedelta(days=7)\n    \n    MPESA_CONSUMER_KEY = os.getenv('MPESA_CONSUMER_KEY', '')\n    MPESA_CONSUMER_SECRET = os.getenv('MPESA_CONSUMER_SECRET', '')\n    MPESA_SHORTCODE = os.getenv('MPESA_SHORTCODE', '')\n    MPESA_PASSKEY = os.getenv('MPESA_PASSKEY', '')\n    MPESA_CALLBACK_URL = os.getenv('MPESA_CALLBACK_URL', '')\n    MPESA_ENVIRONMENT = os.getenv('MPESA_ENVIRONMENT', 'sandbox')\n    \n    SMS_PROVIDER = os.getenv('SMS_PROVIDER', 'twilio')\n    TWILIO_ACCOUNT_SID = os.getenv('TWILIO_ACCOUNT_SID', '')\n    TWILIO_AUTH_TOKEN = os.getenv('TWILIO_AUTH_TOKEN', '')\n    TWILIO_PHONE_NUMBER = os.getenv('TWILIO_PHONE_NUMBER', '')\n\nclass DevelopmentConfig(Config):\n    DEBUG = True\n    TESTING = False\n\nclass ProductionConfig(Config):\n    DEBUG = False\n    TESTING = False\n    SESSION_COOKIE_SECURE = True\n\nconfig = {\n    'development': DevelopmentConfig,\n    'production': ProductionConfig,\n    'default': DevelopmentConfig\n}\n","size_bytes":1565},"backend_backup_20251109_155046/__init__.py":{"content":"from flask import Flask\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_login import LoginManager\nfrom flask_cors import CORS\nfrom config import config\nimport os\n\ndb = SQLAlchemy()\nlogin_manager = LoginManager()\n\ndef create_app(config_name='default'):\n    app = Flask(__name__)\n    app.config.from_object(config[config_name])\n    \n    CORS(app, supports_credentials=True)\n    \n    db.init_app(app)\n    login_manager.init_app(app)\n    login_manager.login_view = 'auth.login'\n    \n    with app.app_context():\n        from app.models import user, tenant, payment, template, sms_log, alert\n        \n        from app.routes import auth_routes, tenant_routes, payment_routes, dashboard_routes, messaging_routes, mpesa_routes\n        \n        app.register_blueprint(auth_routes.bp)\n        app.register_blueprint(tenant_routes.bp)\n        app.register_blueprint(payment_routes.bp)\n        app.register_blueprint(dashboard_routes.bp)\n        app.register_blueprint(messaging_routes.bp)\n        app.register_blueprint(mpesa_routes.bp)\n        \n        db.create_all()\n    \n    return app\n","size_bytes":1082},"frontend/src/pages/Messaging.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Messaging() {\n  const [templates, setTemplates] = useState([])\n  const [tenants, setTenants] = useState([])\n  const [smsLogs, setSmsLogs] = useState([])\n  const [showModal, setShowModal] = useState(false)\n  const { theme } = useTheme()\n  const [formData, setFormData] = useState({\n    tenant_id: '',\n    template_id: '',\n    message: '',\n    placeholders: {}\n  })\n\n  useEffect(() => {\n    fetchTemplates()\n    fetchTenants()\n    fetchSmsLogs()\n  }, [])\n\n  const fetchTemplates = async () => {\n    try {\n      const response = await api.get('/messaging/templates')\n      setTemplates(response.data.templates)\n    } catch (error) {\n      console.error('Failed to fetch templates:', error)\n    }\n  }\n\n  const fetchTenants = async () => {\n    try {\n      const response = await api.get('/tenants')\n      setTenants(response.data.tenants)\n    } catch (error) {\n      console.error('Failed to fetch tenants:', error)\n    }\n  }\n\n  const fetchSmsLogs = async () => {\n    try {\n      const response = await api.get('/messaging/sms-logs')\n      setSmsLogs(response.data.sms_logs)\n    } catch (error) {\n      console.error('Failed to fetch SMS logs:', error)\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    try {\n      await api.post('/messaging/send-sms', formData)\n      setShowModal(false)\n      setFormData({\n        tenant_id: '',\n        template_id: '',\n        message: '',\n        placeholders: {}\n      })\n      fetchSmsLogs()\n    } catch (error) {\n      console.error('Failed to send SMS:', error)\n    }\n  }\n\n  const getTenantName = (tenantId) => {\n    const tenant = tenants.find(t => t.id === parseInt(tenantId))\n    return tenant ? tenant.full_name : 'Unknown'\n  }\n\n  const getPreviewMessage = (content) => {\n    return content\n      .replace(/{tenant_name}/g, 'John Doe')\n      .replace(/{unit_number}/g, 'A101')\n      .replace(/{amount}/g, '15,000')\n      .replace(/{payment_date}/g, '15/11/2025')\n      .replace(/{remaining_amount}/g, '5,000')\n      .replace(/{transaction_reference}/g, 'MPE12345')\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-3xl font-bold\" style={{ color: 'var(--theme-text)' }}>\n          Messaging\n        </h1>\n        <button\n          onClick={() => setShowModal(true)}\n          className=\"theme-button px-4 py-2 font-medium flex items-center space-x-2\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n          </svg>\n          <span>Send SMS</span>\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"theme-card p-6\">\n          <h2 className=\"text-xl font-bold mb-4 flex items-center space-x-2\" style={{ color: 'var(--theme-text)' }}>\n            <i className=\"fas fa-file-lines\"></i>\n            <span>Message Templates</span>\n          </h2>\n          <div className=\"space-y-3\">\n            {templates.map((template) => (\n              <div key={template.id} className=\"p-4 border-2 transition-all hover:scale-102\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                }}\n              >\n                <div className=\"flex justify-between items-start mb-2\">\n                  <h3 className=\"font-semibold\" style={{ color: 'var(--theme-text)' }}>{template.name}</h3>\n                  <span\n                    className=\"text-xs px-2 py-1 font-medium\"\n                    style={{\n                      backgroundColor: template.theme === 'friendly' ? (theme === 'friendly' ? '#fed7aa' : '#fef3c7') : (theme === 'friendly' ? '#dbeafe' : '#e0e7ff'),\n                      color: 'var(--theme-text)',\n                      borderRadius: theme === 'friendly' ? '1rem' : '0.375rem',\n                    }}\n                  >\n                    {template.theme}\n                  </span>\n                </div>\n                <p className=\"text-sm italic\" style={{ color: 'var(--theme-text-secondary)' }}>\n                  {getPreviewMessage(template.content)}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"theme-card p-6\">\n          <h2 className=\"text-xl font-bold mb-4 flex items-center space-x-2\" style={{ color: 'var(--theme-text)' }}>\n            <i className=\"fas fa-envelope\"></i>\n            <span>Recent SMS</span>\n          </h2>\n          <div className=\"space-y-3 max-h-[600px] overflow-y-auto\">\n            {smsLogs.slice(0, 20).map((log) => (\n              <div key={log.id} className=\"p-4 border-2 transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border-light)',\n                  borderRadius: 'var(--theme-radius)',\n                }}\n              >\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div>\n                    <div className=\"font-semibold\" style={{ color: 'var(--theme-text)' }}>{log.recipient_name}</div>\n                    <div className=\"text-xs\" style={{ color: 'var(--theme-text-secondary)' }}>{log.recipient_phone}</div>\n                  </div>\n                  <span\n                    className=\"text-xs px-2 py-1 font-medium text-white\"\n                    style={{\n                      backgroundColor: log.status === 'sent' ? (theme === 'friendly' ? '#34d399' : '#059669') : (theme === 'friendly' ? '#f87171' : '#dc2626'),\n                      borderRadius: theme === 'friendly' ? '1rem' : '0.375rem',\n                    }}\n                  >\n                    {log.status}\n                  </span>\n                </div>\n                <p className=\"text-sm mb-2\" style={{ color: 'var(--theme-text)' }}>{log.message}</p>\n                <div className=\"text-xs\" style={{ color: 'var(--theme-text-secondary)' }}>\n                  {new Date(log.sent_at).toLocaleString()}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"theme-card max-w-md w-full max-h-screen overflow-y-auto p-6\">\n            <h2 className=\"text-2xl font-bold mb-6\" style={{ color: 'var(--theme-text)' }}>\n              Send SMS\n            </h2>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Tenant</label>\n                <select\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.tenant_id}\n                  onChange={(e) => setFormData({ ...formData, tenant_id: e.target.value })}\n                  required\n                >\n                  <option value=\"\">Select Tenant</option>\n                  {tenants.map((tenant) => (\n                    <option key={tenant.id} value={tenant.id}>\n                      {tenant.full_name} - {tenant.phone}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Template (optional)</label>\n                <select\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.template_id}\n                  onChange={(e) => setFormData({ ...formData, template_id: e.target.value })}\n                >\n                  <option value=\"\">Custom Message</option>\n                  {templates.map((template) => (\n                    <option key={template.id} value={template.id}>\n                      {template.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Message</label>\n                <textarea\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  rows=\"4\"\n                  placeholder=\"Type your message here...\"\n                  value={formData.message}\n                  onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n                  required={!formData.template_id}\n                />\n              </div>\n              <div className=\"flex space-x-3 pt-4\">\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 theme-button px-4 py-3 font-medium\"\n                >\n                  Send SMS\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowModal(false)}\n                  className=\"flex-1 px-4 py-3 font-medium transition-all\"\n                  style={{\n                    backgroundColor: '#e5e7eb',\n                    color: '#374151',\n                    borderRadius: 'var(--theme-radius)',\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":10202},"backend/app/routes/mpesa_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required\nfrom app import db\nfrom app.models.payment import Payment\nfrom app.models.tenant import Tenant\nfrom app.models.alert import Alert\nfrom app.services.mpesa_service import MPesaService\nfrom app.utils.decorators import admin_or_caretaker_required\nfrom datetime import datetime\n\nbp = Blueprint('mpesa', __name__, url_prefix='/api/mpesa')\n\n@bp.route('/callback', methods=['POST'])\ndef mpesa_callback():\n    data = request.get_json()\n    \n    mpesa_service = MPesaService()\n    result = mpesa_service.process_callback(data)\n    \n    if result:\n        tenant = result.get('tenant')\n        if tenant:\n            payment = Payment(\n                tenant_id=tenant.id,\n                amount=result['amount'],\n                payment_date=datetime.now().date(),\n                payment_method='M-PESA',\n                transaction_reference=result['transaction_id']\n            )\n            \n            payment.calculate_status(tenant.expected_rent)\n            \n            db.session.add(payment)\n            \n            alert = Alert(\n                alert_type='mpesa_payment_received',\n                message=f'M-PESA payment of KES {payment.amount} received from {tenant.full_name}',\n                severity='success',\n                related_tenant_id=tenant.id,\n                related_payment_id=payment.id\n            )\n            db.session.add(alert)\n            \n            db.session.commit()\n            \n            return jsonify({'message': 'Payment processed successfully'}), 200\n        else:\n            alert = Alert(\n                alert_type='mpesa_unmatched',\n                message=f'Unmatched M-PESA payment of KES {result[\"amount\"]} from {result[\"phone\"]}',\n                severity='warning'\n            )\n            db.session.add(alert)\n            db.session.commit()\n            \n            return jsonify({'message': 'Payment received but tenant not matched'}), 200\n    \n    return jsonify({'error': 'Failed to process callback'}), 400\n\n@bp.route('/initiate-stk', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef initiate_stk_push():\n    data = request.get_json()\n    \n    tenant = Tenant.query.get_or_404(data['tenant_id'])\n    amount = data['amount']\n    \n    mpesa_service = MPesaService()\n    result = mpesa_service.initiate_stk_push(tenant.phone, amount, tenant.full_name)\n    \n    if result:\n        return jsonify({'message': 'STK push initiated', 'checkout_request_id': result}), 200\n    \n    return jsonify({'error': 'Failed to initiate STK push'}), 500\n","size_bytes":2604},"backend/app/models/user.py":{"content":"from app import db, login_manager\nfrom flask_login import UserMixin\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom datetime import datetime\nimport pytz\n\n@login_manager.user_loader\ndef load_user(user_id):\n    return User.query.get(int(user_id))\n\nclass User(UserMixin, db.Model):\n    __tablename__ = 'users'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80), unique=True, nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    password_hash = db.Column(db.String(255), nullable=False)\n    role = db.Column(db.String(20), nullable=False)\n    phone = db.Column(db.String(20))\n    full_name = db.Column(db.String(120))\n    is_active = db.Column(db.Boolean, default=True)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')), onupdate=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    payments = db.relationship('Payment', backref='logged_by_user', lazy=True, foreign_keys='Payment.logged_by')\n    \n    def set_password(self, password):\n        self.password_hash = generate_password_hash(password)\n    \n    def check_password(self, password):\n        return check_password_hash(self.password_hash, password)\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'username': self.username,\n            'email': self.email,\n            'role': self.role,\n            'phone': self.phone,\n            'full_name': self.full_name,\n            'is_active': self.is_active,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":1759},"backend/app/routes/payment_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required, current_user\nfrom app import db\nfrom app.models.payment import Payment\nfrom app.models.tenant import Tenant\nfrom app.models.alert import Alert\nfrom app.services.messaging_service import MessagingService\nfrom app.utils.decorators import admin_or_caretaker_required\nfrom datetime import datetime\n\nbp = Blueprint('payments', __name__, url_prefix='/api/payments')\n\n@bp.route('', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_payments():\n    tenant_id = request.args.get('tenant_id')\n    \n    query = Payment.query\n    if tenant_id:\n        query = query.filter_by(tenant_id=tenant_id)\n    \n    payments = query.order_by(Payment.payment_date.desc()).all()\n    return jsonify({'payments': [p.to_dict() for p in payments]}), 200\n\n@bp.route('/<int:payment_id>', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_payment(payment_id):\n    payment = Payment.query.get_or_404(payment_id)\n    return jsonify({'payment': payment.to_dict()}), 200\n\n@bp.route('', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef create_payment():\n    data = request.get_json()\n    \n    tenant = Tenant.query.get_or_404(data['tenant_id'])\n    \n    payment = Payment(\n        tenant_id=data['tenant_id'],\n        amount=data['amount'],\n        payment_date=datetime.fromisoformat(data['payment_date']).date(),\n        payment_method=data['payment_method'],\n        transaction_reference=data.get('transaction_reference', ''),\n        notes=data.get('notes', ''),\n        logged_by=current_user.id\n    )\n    \n    payment.calculate_status(tenant.expected_rent)\n    \n    db.session.add(payment)\n    \n    alert = Alert(\n        alert_type='payment_logged',\n        message=f'Payment of KES {payment.amount} logged for {tenant.full_name} - Unit {tenant.unit_number}',\n        severity='info',\n        related_tenant_id=tenant.id,\n        related_payment_id=payment.id\n    )\n    db.session.add(alert)\n    \n    db.session.commit()\n    \n    if data.get('send_receipt', False):\n        messaging_service = MessagingService()\n        messaging_service.send_payment_receipt(payment, tenant)\n    \n    return jsonify({'message': 'Payment logged successfully', 'payment': payment.to_dict()}), 201\n\n@bp.route('/<int:payment_id>/send-receipt', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef send_receipt(payment_id):\n    payment = Payment.query.get_or_404(payment_id)\n    tenant = Tenant.query.get(payment.tenant_id)\n    \n    messaging_service = MessagingService()\n    success = messaging_service.send_payment_receipt(payment, tenant)\n    \n    if success:\n        payment.receipt_sent = True\n        db.session.commit()\n        return jsonify({'message': 'Receipt sent successfully'}), 200\n    \n    return jsonify({'error': 'Failed to send receipt'}), 500\n\n@bp.route('/audit-trail', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_audit_trail():\n    payments = Payment.query.order_by(Payment.created_at.desc()).all()\n    \n    audit_data = []\n    for payment in payments:\n        tenant = Tenant.query.get(payment.tenant_id)\n        audit_data.append({\n            **payment.to_dict(),\n            'tenant_name': tenant.full_name if tenant else 'Unknown',\n            'unit_number': tenant.unit_number if tenant else 'Unknown'\n        })\n    \n    return jsonify({'audit_trail': audit_data}), 200\n","size_bytes":3434},"backend/app/routes/tenant_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required\nfrom app import db\nfrom app.models.tenant import Tenant\nfrom app.utils.decorators import admin_or_caretaker_required\nfrom datetime import datetime\n\nbp = Blueprint('tenants', __name__, url_prefix='/api/tenants')\n\n@bp.route('', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_tenants():\n    search = request.args.get('search', '')\n    is_active = request.args.get('is_active', 'true').lower() == 'true'\n    \n    query = Tenant.query.filter_by(is_active=is_active)\n    \n    if search:\n        search_filter = f'%{search}%'\n        query = query.filter(\n            db.or_(\n                Tenant.full_name.ilike(search_filter),\n                Tenant.phone.ilike(search_filter),\n                Tenant.unit_number.ilike(search_filter),\n                Tenant.email.ilike(search_filter)\n            )\n        )\n    \n    tenants = query.all()\n    return jsonify({'tenants': [t.to_dict() for t in tenants]}), 200\n\n@bp.route('/<int:tenant_id>', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_tenant(tenant_id):\n    tenant = Tenant.query.get_or_404(tenant_id)\n    return jsonify({'tenant': tenant.to_dict()}), 200\n\n@bp.route('', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef create_tenant():\n    data = request.get_json()\n    \n    tenant = Tenant(\n        full_name=data['full_name'],\n        phone=data['phone'],\n        email=data.get('email', ''),\n        unit_number=data['unit_number'],\n        expected_rent=data['expected_rent'],\n        deposit_amount=data.get('deposit_amount', 0.0),\n        lease_start_date=datetime.fromisoformat(data['lease_start_date']).date(),\n        lease_end_date=datetime.fromisoformat(data['lease_end_date']).date(),\n        notes=data.get('notes', '')\n    )\n    \n    db.session.add(tenant)\n    db.session.commit()\n    \n    return jsonify({'message': 'Tenant created successfully', 'tenant': tenant.to_dict()}), 201\n\n@bp.route('/<int:tenant_id>', methods=['PUT'])\n@login_required\n@admin_or_caretaker_required\ndef update_tenant(tenant_id):\n    tenant = Tenant.query.get_or_404(tenant_id)\n    data = request.get_json()\n    \n    tenant.full_name = data.get('full_name', tenant.full_name)\n    tenant.phone = data.get('phone', tenant.phone)\n    tenant.email = data.get('email', tenant.email)\n    tenant.unit_number = data.get('unit_number', tenant.unit_number)\n    tenant.expected_rent = data.get('expected_rent', tenant.expected_rent)\n    tenant.deposit_amount = data.get('deposit_amount', tenant.deposit_amount)\n    tenant.notes = data.get('notes', tenant.notes)\n    \n    if 'lease_start_date' in data:\n        tenant.lease_start_date = datetime.fromisoformat(data['lease_start_date']).date()\n    if 'lease_end_date' in data:\n        tenant.lease_end_date = datetime.fromisoformat(data['lease_end_date']).date()\n    \n    db.session.commit()\n    \n    return jsonify({'message': 'Tenant updated successfully', 'tenant': tenant.to_dict()}), 200\n\n@bp.route('/<int:tenant_id>', methods=['DELETE'])\n@login_required\n@admin_or_caretaker_required\ndef delete_tenant(tenant_id):\n    tenant = Tenant.query.get_or_404(tenant_id)\n    tenant.is_active = False\n    db.session.commit()\n    \n    return jsonify({'message': 'Tenant deactivated successfully'}), 200\n","size_bytes":3322},"frontend/src/pages/Tenants.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Tenants() {\n  const [tenants, setTenants] = useState([])\n  const [search, setSearch] = useState('')\n  const [showModal, setShowModal] = useState(false)\n  const [activeTab, setActiveTab] = useState('active')\n  const { theme } = useTheme()\n  const [formData, setFormData] = useState({\n    full_name: '',\n    phone: '',\n    email: '',\n    unit_number: '',\n    expected_rent: '',\n    deposit_amount: '',\n    lease_start_date: '',\n    lease_end_date: '',\n    notes: ''\n  })\n\n  useEffect(() => {\n    fetchTenants()\n  }, [search, activeTab])\n\n  const fetchTenants = async () => {\n    try {\n      const isActive = activeTab === 'active'\n      const response = await api.get(`/tenants?search=${search}&is_active=${isActive}`)\n      setTenants(response.data.tenants)\n    } catch (error) {\n      console.error('Failed to fetch tenants:', error)\n    }\n  }\n\n  const handleToggleActive = async (tenantId) => {\n    try {\n      await api.delete(`/tenants/${tenantId}`)\n      fetchTenants()\n    } catch (error) {\n      console.error('Failed to toggle tenant status:', error)\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    try {\n      await api.post('/tenants', formData)\n      setShowModal(false)\n      setFormData({\n        full_name: '',\n        phone: '',\n        email: '',\n        unit_number: '',\n        expected_rent: '',\n        deposit_amount: '',\n        lease_start_date: '',\n        lease_end_date: '',\n        notes: ''\n      })\n      fetchTenants()\n    } catch (error) {\n      console.error('Failed to create tenant:', error)\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n        <h1 className=\"text-2xl sm:text-3xl font-bold\" style={{ color: 'var(--theme-text)' }}>\n          Tenants\n        </h1>\n        <button\n          onClick={() => setShowModal(true)}\n          className=\"theme-button px-4 py-2 font-medium flex items-center justify-center space-x-2\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n          </svg>\n          <span>Add Tenant</span>\n        </button>\n      </div>\n\n      <div className=\"theme-card p-4 space-y-4\">\n        <div className=\"flex space-x-2 border-b\" style={{ borderColor: 'var(--theme-border)' }}>\n          <button\n            onClick={() => setActiveTab('active')}\n            className={`px-4 py-2 font-medium transition-all ${activeTab === 'active' ? 'border-b-2' : ''}`}\n            style={{\n              borderColor: activeTab === 'active' ? 'var(--theme-primary)' : 'transparent',\n              color: activeTab === 'active' ? 'var(--theme-primary)' : 'var(--theme-text-secondary)'\n            }}\n          >\n            <i className=\"fas fa-check-circle mr-2\"></i>\n            Active Tenants\n          </button>\n          <button\n            onClick={() => setActiveTab('inactive')}\n            className={`px-4 py-2 font-medium transition-all ${activeTab === 'inactive' ? 'border-b-2' : ''}`}\n            style={{\n              borderColor: activeTab === 'inactive' ? 'var(--theme-primary)' : 'transparent',\n              color: activeTab === 'inactive' ? 'var(--theme-primary)' : 'var(--theme-text-secondary)'\n            }}\n          >\n            <i className=\"fas fa-archive mr-2\"></i>\n            Moved Out ({tenants.length})\n          </button>\n        </div>\n        <input\n          type=\"text\"\n          placeholder=\"Search by name, phone, unit...\"\n          className=\"w-full px-4 py-3 border-2 focus:outline-none focus:ring-0 transition-all\"\n          style={{\n            borderColor: 'var(--theme-border)',\n            borderRadius: 'var(--theme-radius)',\n            color: 'var(--theme-text)',\n          }}\n          value={search}\n          onChange={(e) => setSearch(e.target.value)}\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {tenants.map((tenant) => (\n          <div key={tenant.id} className=\"theme-card p-6 hover:scale-105 transition-transform duration-200\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div \n                className=\"h-14 w-14 rounded-full flex items-center justify-center text-white text-xl font-bold\"\n                style={{ backgroundColor: 'var(--theme-primary)' }}\n              >\n                {tenant.initials}\n              </div>\n              <span \n                className=\"px-3 py-1 text-xs font-medium rounded-full\"\n                style={{\n                  backgroundColor: tenant.is_active ? (theme === 'friendly' ? '#34d399' : '#059669') : '#9ca3af',\n                  color: 'white',\n                  borderRadius: theme === 'friendly' ? '1rem' : '0.5rem',\n                }}\n              >\n                {tenant.is_active ? 'Active' : 'Inactive'}\n              </span>\n            </div>\n            <h3 className=\"text-xl font-bold mb-4\" style={{ color: 'var(--theme-text)' }}>\n              {tenant.full_name}\n            </h3>\n            <div className=\"space-y-3 text-sm\">\n              <div className=\"flex justify-between items-center\">\n                <span style={{ color: 'var(--theme-text-secondary)' }}>Unit</span>\n                <span className=\"font-semibold\" style={{ color: 'var(--theme-text)' }}>\n                  {tenant.unit_number}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span style={{ color: 'var(--theme-text-secondary)' }}>Phone</span>\n                <span className=\"font-semibold\" style={{ color: 'var(--theme-text)' }}>\n                  {tenant.phone}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span style={{ color: 'var(--theme-text-secondary)' }}>Rent</span>\n                <span className=\"font-bold text-lg\" style={{ color: 'var(--theme-primary)' }}>\n                  KES {tenant.expected_rent?.toLocaleString()}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center pt-2 border-t\" style={{ borderColor: 'var(--theme-border-light)' }}>\n                <span style={{ color: 'var(--theme-text-secondary)' }}>Lease Ends</span>\n                <span className=\"font-medium\" style={{ color: 'var(--theme-text)' }}>\n                  {new Date(tenant.lease_end_date).toLocaleDateString()}\n                </span>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"theme-card max-w-md w-full max-h-screen overflow-y-auto p-6\">\n            <h2 className=\"text-2xl font-bold mb-6\" style={{ color: 'var(--theme-text)' }}>\n              Add New Tenant\n            </h2>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <input\n                type=\"text\"\n                placeholder=\"Full Name\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.full_name}\n                onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}\n                required\n              />\n              <input\n                type=\"tel\"\n                placeholder=\"Phone Number\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.phone}\n                onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                required\n              />\n              <input\n                type=\"email\"\n                placeholder=\"Email (optional)\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.email}\n                onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n              />\n              <input\n                type=\"text\"\n                placeholder=\"Unit Number\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.unit_number}\n                onChange={(e) => setFormData({ ...formData, unit_number: e.target.value })}\n                required\n              />\n              <input\n                type=\"number\"\n                placeholder=\"Expected Rent (KES)\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.expected_rent}\n                onChange={(e) => setFormData({ ...formData, expected_rent: e.target.value })}\n                required\n              />\n              <input\n                type=\"number\"\n                placeholder=\"Deposit Amount (KES)\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                value={formData.deposit_amount}\n                onChange={(e) => setFormData({ ...formData, deposit_amount: e.target.value })}\n              />\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Lease Start Date</label>\n                <input\n                  type=\"date\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.lease_start_date}\n                  onChange={(e) => setFormData({ ...formData, lease_start_date: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Lease End Date</label>\n                <input\n                  type=\"date\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.lease_end_date}\n                  onChange={(e) => setFormData({ ...formData, lease_end_date: e.target.value })}\n                  required\n                />\n              </div>\n              <textarea\n                placeholder=\"Notes (optional)\"\n                className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                rows=\"3\"\n                value={formData.notes}\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n              />\n              <div className=\"flex space-x-3 pt-4\">\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 theme-button px-4 py-3 font-medium\"\n                >\n                  Save Tenant\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowModal(false)}\n                  className=\"flex-1 px-4 py-3 font-medium transition-all\"\n                  style={{\n                    backgroundColor: '#e5e7eb',\n                    color: '#374151',\n                    borderRadius: 'var(--theme-radius)',\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":13285},"frontend/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --theme-primary: #f97316;\n  --theme-background: #fff7ed;\n  --theme-surface: #ffffff;\n  --theme-text: #78350f;\n  --theme-radius: 1.5rem;\n  --theme-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.15);\n}\n\n[data-theme=\"friendly\"] {\n  --theme-primary: #f97316;\n  --theme-secondary: #fb923c;\n  --theme-accent: #fbbf24;\n  --theme-success: #34d399;\n  --theme-warning: #fbbf24;\n  --theme-danger: #f87171;\n  --theme-background: #fff7ed;\n  --theme-surface: #ffffff;\n  --theme-text: #78350f;\n  --theme-text-secondary: #9a3412;\n  --theme-border: rgba(154, 52, 18, 0.25);\n  --theme-border-light: rgba(154, 52, 18, 0.15);\n  --theme-border-strong: rgba(154, 52, 18, 0.4);\n  --theme-radius: 1.5rem;\n  --theme-shadow: 0 10px 25px -5px rgba(249, 115, 22, 0.15);\n}\n\n[data-theme=\"formal\"] {\n  --theme-primary: #1e40af;\n  --theme-secondary: #3b82f6;\n  --theme-accent: #60a5fa;\n  --theme-success: #059669;\n  --theme-warning: #d97706;\n  --theme-danger: #dc2626;\n  --theme-background: #f8fafc;\n  --theme-surface: #ffffff;\n  --theme-text: #1e293b;\n  --theme-text-secondary: #475569;\n  --theme-border: rgba(71, 85, 105, 0.25);\n  --theme-border-light: rgba(71, 85, 105, 0.15);\n  --theme-border-strong: rgba(71, 85, 105, 0.4);\n  --theme-radius: 0.375rem;\n  --theme-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);\n}\n\n[data-theme=\"dark\"] {\n  --theme-primary: #3b82f6;\n  --theme-secondary: #60a5fa;\n  --theme-accent: #93c5fd;\n  --theme-success: #10b981;\n  --theme-warning: #f59e0b;\n  --theme-danger: #ef4444;\n  --theme-background: #0f172a;\n  --theme-surface: #1e293b;\n  --theme-text: #f1f5f9;\n  --theme-text-secondary: #cbd5e1;\n  --theme-border: rgba(148, 163, 184, 0.2);\n  --theme-border-light: rgba(148, 163, 184, 0.1);\n  --theme-border-strong: rgba(148, 163, 184, 0.3);\n  --theme-radius: 0.5rem;\n  --theme-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);\n}\n\nbody {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  background-color: var(--theme-background);\n  color: var(--theme-text);\n  transition: background-color 0.3s ease, color 0.3s ease;\n}\n\n[data-theme=\"friendly\"] body {\n  font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, sans-serif;\n}\n\n[data-theme=\"formal\"] body {\n  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;\n}\n\n.theme-card {\n  background-color: var(--theme-surface);\n  border-radius: var(--theme-radius);\n  box-shadow: var(--theme-shadow);\n  transition: all 0.3s ease;\n}\n\n.theme-button {\n  background-color: var(--theme-primary);\n  color: white;\n  border-radius: var(--theme-radius);\n  transition: all 0.2s ease;\n}\n\n.theme-button:hover {\n  opacity: 0.9;\n  transform: translateY(-2px);\n}\n\ncode {\n  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n    monospace;\n}\n","size_bytes":3112},"frontend/src/App.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom'\nimport { ThemeProvider } from './context/ThemeContext'\nimport Login from './pages/Login'\nimport Dashboard from './pages/Dashboard'\nimport Tenants from './pages/Tenants'\nimport Payments from './pages/Payments'\nimport Messaging from './pages/Messaging'\nimport Users from './pages/Users'\nimport Layout from './components/Layout'\nimport api from './services/api'\n\nfunction App() {\n  const [user, setUser] = useState(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    checkSession()\n  }, [])\n\n  const checkSession = async () => {\n    try {\n      const response = await api.get('/auth/check-session')\n      if (response.data.authenticated) {\n        setUser(response.data.user)\n      }\n    } catch (error) {\n      console.error('Session check failed:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleLogin = (userData) => {\n    setUser(userData)\n  }\n\n  const handleLogout = async () => {\n    try {\n      await api.post('/auth/logout')\n      setUser(null)\n    } catch (error) {\n      console.error('Logout failed:', error)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-xl\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <ThemeProvider>\n      <Router>\n        <Routes>\n        <Route\n          path=\"/login\"\n          element={user ? <Navigate to=\"/\" /> : <Login onLogin={handleLogin} />}\n        />\n        <Route\n          path=\"/\"\n          element={\n            user ? (\n              <Layout user={user} onLogout={handleLogout}>\n                <Dashboard />\n              </Layout>\n            ) : (\n              <Navigate to=\"/login\" />\n            )\n          }\n        />\n        <Route\n          path=\"/tenants\"\n          element={\n            user ? (\n              <Layout user={user} onLogout={handleLogout}>\n                <Tenants />\n              </Layout>\n            ) : (\n              <Navigate to=\"/login\" />\n            )\n          }\n        />\n        <Route\n          path=\"/payments\"\n          element={\n            user ? (\n              <Layout user={user} onLogout={handleLogout}>\n                <Payments />\n              </Layout>\n            ) : (\n              <Navigate to=\"/login\" />\n            )\n          }\n        />\n        <Route\n          path=\"/messaging\"\n          element={\n            user ? (\n              <Layout user={user} onLogout={handleLogout}>\n                <Messaging />\n              </Layout>\n            ) : (\n              <Navigate to=\"/login\" />\n            )\n          }\n        />\n        <Route\n          path=\"/users\"\n          element={\n            user && user.role === 'super_admin' ? (\n              <Layout user={user} onLogout={handleLogout}>\n                <Users />\n              </Layout>\n            ) : (\n              <Navigate to=\"/\" />\n            )\n          }\n        />\n        </Routes>\n      </Router>\n    </ThemeProvider>\n  )\n}\n\nexport default App\n","size_bytes":3114},"backend/init_data.py":{"content":"from app import create_app, db\nfrom app.models.user import User\nfrom app.models.tenant import Tenant\nfrom app.models.template import Template\nfrom datetime import datetime, timedelta\nimport pytz\n\napp = create_app('development')\n\ndef init_sample_data():\n    with app.app_context():\n        db.create_all()\n        \n        if User.query.count() == 0:\n            admin = User(\n                username='admin',\n                email='admin@property.com',\n                role='super_admin',\n                phone='+254712345678',\n                full_name='Property Owner'\n            )\n            admin.set_password('admin123')\n            db.session.add(admin)\n            \n            caretaker = User(\n                username='caretaker',\n                email='caretaker@property.com',\n                role='caretaker',\n                phone='+254723456789',\n                full_name='John Caretaker'\n            )\n            caretaker.set_password('care123')\n            db.session.add(caretaker)\n            \n            print(' Created users: admin/admin123, caretaker/care123')\n        \n        if Tenant.query.count() == 0:\n            tz = pytz.timezone('Africa/Nairobi')\n            today = datetime.now(tz).date()\n            \n            tenants_data = [\n                {\n                    'full_name': 'Jane Wanjiku',\n                    'phone': '+254701234567',\n                    'email': 'jane@email.com',\n                    'unit_number': 'A101',\n                    'expected_rent': 15000,\n                    'deposit_amount': 30000,\n                    'lease_start_date': today - timedelta(days=180),\n                    'lease_end_date': today + timedelta(days=185)\n                },\n                {\n                    'full_name': 'Peter Kamau',\n                    'phone': '+254702345678',\n                    'email': 'peter@email.com',\n                    'unit_number': 'A102',\n                    'expected_rent': 18000,\n                    'deposit_amount': 36000,\n                    'lease_start_date': today - timedelta(days=150),\n                    'lease_end_date': today + timedelta(days=215)\n                },\n                {\n                    'full_name': 'Mary Njeri',\n                    'phone': '+254703456789',\n                    'email': 'mary@email.com',\n                    'unit_number': 'B201',\n                    'expected_rent': 20000,\n                    'deposit_amount': 40000,\n                    'lease_start_date': today - timedelta(days=90),\n                    'lease_end_date': today + timedelta(days=275)\n                },\n                {\n                    'full_name': 'David Ochieng',\n                    'phone': '+254704567890',\n                    'email': 'david@email.com',\n                    'unit_number': 'B202',\n                    'expected_rent': 17000,\n                    'deposit_amount': 34000,\n                    'lease_start_date': today - timedelta(days=200),\n                    'lease_end_date': today + timedelta(days=165)\n                },\n                {\n                    'full_name': 'Grace Akinyi',\n                    'phone': '+254705678901',\n                    'email': 'grace@email.com',\n                    'unit_number': 'C301',\n                    'expected_rent': 22000,\n                    'deposit_amount': 44000,\n                    'lease_start_date': today - timedelta(days=60),\n                    'lease_end_date': today + timedelta(days=305)\n                }\n            ]\n            \n            for tenant_data in tenants_data:\n                tenant = Tenant(**tenant_data)\n                db.session.add(tenant)\n            \n            print(f' Created {len(tenants_data)} sample tenants')\n        \n        if Template.query.count() == 0:\n            templates_data = [\n                {\n                    'name': 'Payment Receipt - Formal',\n                    'category': 'receipt',\n                    'theme': 'formal',\n                    'content': 'Dear {tenant_name}, this is to confirm receipt of KES {amount} for Unit {unit_number} on {payment_date}. Transaction Ref: {transaction_reference}. Balance: KES {remaining_amount}. Thank you.'\n                },\n                {\n                    'name': 'Payment Receipt - Friendly',\n                    'category': 'receipt',\n                    'theme': 'friendly',\n                    'content': 'Hi {tenant_name}! We received your payment of KES {amount} for Unit {unit_number}. Thanks! Remaining balance: KES {remaining_amount}.'\n                },\n                {\n                    'name': 'Rent Reminder - Formal',\n                    'category': 'reminder',\n                    'theme': 'formal',\n                    'content': 'Dear {tenant_name}, this is a reminder that your rent of KES {remaining_amount} for Unit {unit_number} is due. Please make payment at your earliest convenience.'\n                },\n                {\n                    'name': 'Rent Reminder - Friendly',\n                    'category': 'reminder',\n                    'theme': 'friendly',\n                    'content': 'Hey {tenant_name}! Just a friendly reminder about the rent for Unit {unit_number}. KES {remaining_amount} is due. Let us know if you need anything!'\n                },\n                {\n                    'name': 'Partial Payment Follow-up - Formal',\n                    'category': 'follow_up',\n                    'theme': 'formal',\n                    'content': 'Dear {tenant_name}, we acknowledge your partial payment. Your remaining balance for Unit {unit_number} is KES {remaining_amount}. Please complete payment soon.'\n                },\n                {\n                    'name': 'Partial Payment Follow-up - Friendly',\n                    'category': 'follow_up',\n                    'theme': 'friendly',\n                    'content': 'Hi {tenant_name}! Thanks for the partial payment. You still have KES {remaining_amount} pending for Unit {unit_number}. No rush, just keeping you updated!'\n                }\n            ]\n            \n            for template_data in templates_data:\n                template = Template(**template_data)\n                db.session.add(template)\n            \n            print(f' Created {len(templates_data)} message templates')\n        \n        db.session.commit()\n        print('\\n Database initialized successfully!')\n        print('\\nLogin Credentials:')\n        print('  Admin: admin / admin123')\n        print('  Caretaker: caretaker / care123')\n\nif __name__ == '__main__':\n    init_sample_data()\n","size_bytes":6587},"frontend/src/pages/Payments.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Payments() {\n  const [payments, setPayments] = useState([])\n  const [tenants, setTenants] = useState([])\n  const [showModal, setShowModal] = useState(false)\n  const { theme } = useTheme()\n  const [formData, setFormData] = useState({\n    tenant_id: '',\n    amount: '',\n    payment_date: new Date().toISOString().split('T')[0],\n    payment_method: 'Cash',\n    transaction_reference: '',\n    notes: '',\n    send_receipt: true\n  })\n\n  useEffect(() => {\n    fetchPayments()\n    fetchTenants()\n  }, [])\n\n  const fetchPayments = async () => {\n    try {\n      const response = await api.get('/payments')\n      setPayments(response.data.payments)\n    } catch (error) {\n      console.error('Failed to fetch payments:', error)\n    }\n  }\n\n  const fetchTenants = async () => {\n    try {\n      const response = await api.get('/tenants')\n      setTenants(response.data.tenants)\n    } catch (error) {\n      console.error('Failed to fetch tenants:', error)\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    try {\n      await api.post('/payments', formData)\n      setShowModal(false)\n      setFormData({\n        tenant_id: '',\n        amount: '',\n        payment_date: new Date().toISOString().split('T')[0],\n        payment_method: 'Cash',\n        transaction_reference: '',\n        notes: '',\n        send_receipt: true\n      })\n      fetchPayments()\n    } catch (error) {\n      console.error('Failed to log payment:', error)\n    }\n  }\n\n  const getStatusColor = (status) => {\n    if (status === 'Full') return theme === 'friendly' ? '#34d399' : '#059669'\n    if (status === 'Partial') return theme === 'friendly' ? '#fbbf24' : '#d97706'\n    return '#9ca3af'\n  }\n\n  const getTenantName = (tenantId) => {\n    const tenant = tenants.find(t => t.id === tenantId)\n    return tenant ? tenant.full_name : 'Unknown'\n  }\n\n  const getTenantUnit = (tenantId) => {\n    const tenant = tenants.find(t => t.id === tenantId)\n    return tenant ? tenant.unit_number : '-'\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-3xl font-bold\" style={{ color: 'var(--theme-text)' }}>\n          Payments\n        </h1>\n        <button\n          onClick={() => setShowModal(true)}\n          className=\"theme-button px-4 py-2 font-medium flex items-center space-x-2\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n          </svg>\n          <span>Log Payment</span>\n        </button>\n      </div>\n\n      <div className=\"theme-card overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            <thead>\n              <tr style={{ backgroundColor: theme === 'friendly' ? '#fed7aa' : '#e2e8f0' }}>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Date</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Tenant</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Unit</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Amount</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Method</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Status</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Remaining</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n              {payments.map((payment) => (\n                <tr key={payment.id} className=\"hover:bg-gray-50 transition-colors\">\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\" style={{ color: 'var(--theme-text)' }}>\n                    {new Date(payment.payment_date).toLocaleDateString()}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\" style={{ color: 'var(--theme-text)' }}>\n                    {getTenantName(payment.tenant_id)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>\n                    {getTenantUnit(payment.tenant_id)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-bold\" style={{ color: 'var(--theme-primary)' }}>\n                    KES {payment.amount?.toLocaleString()}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>\n                    {payment.payment_method}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\n                    <span\n                      className=\"px-3 py-1 text-xs font-medium text-white\"\n                      style={{\n                        backgroundColor: getStatusColor(payment.payment_status),\n                        borderRadius: theme === 'friendly' ? '1rem' : '0.375rem',\n                      }}\n                    >\n                      {payment.payment_status}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\" style={{ color: theme === 'friendly' ? '#fbbf24' : '#d97706' }}>\n                    {payment.remaining_amount > 0 ? `KES ${payment.remaining_amount?.toLocaleString()}` : '-'}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"theme-card max-w-md w-full max-h-screen overflow-y-auto p-6\">\n            <h2 className=\"text-2xl font-bold mb-6\" style={{ color: 'var(--theme-text)' }}>\n              Log Payment\n            </h2>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Tenant</label>\n                <select\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.tenant_id}\n                  onChange={(e) => setFormData({ ...formData, tenant_id: e.target.value })}\n                  required\n                >\n                  <option value=\"\">Select Tenant</option>\n                  {tenants.map((tenant) => (\n                    <option key={tenant.id} value={tenant.id}>\n                      {tenant.full_name} - Unit {tenant.unit_number}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Amount (KES)</label>\n                <input\n                  type=\"number\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.amount}\n                  onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Payment Date</label>\n                <input\n                  type=\"date\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.payment_date}\n                  onChange={(e) => setFormData({ ...formData, payment_date: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Payment Method</label>\n                <select\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.payment_method}\n                  onChange={(e) => setFormData({ ...formData, payment_method: e.target.value })}\n                >\n                  <option value=\"Cash\">Cash</option>\n                  <option value=\"M-PESA\">M-PESA</option>\n                  <option value=\"Bank Transfer\">Bank Transfer</option>\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Transaction Reference</label>\n                <input\n                  type=\"text\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  placeholder=\"Optional\"\n                  value={formData.transaction_reference}\n                  onChange={(e) => setFormData({ ...formData, transaction_reference: e.target.value })}\n                />\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"send_receipt\"\n                  checked={formData.send_receipt}\n                  onChange={(e) => setFormData({ ...formData, send_receipt: e.target.checked })}\n                  className=\"h-4 w-4\"\n                />\n                <label htmlFor=\"send_receipt\" className=\"text-sm\" style={{ color: 'var(--theme-text)' }}>\n                  Send SMS Receipt to Tenant\n                </label>\n              </div>\n              <div className=\"flex space-x-3 pt-4\">\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 theme-button px-4 py-3 font-medium\"\n                >\n                  Log Payment\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => setShowModal(false)}\n                  className=\"flex-1 px-4 py-3 font-medium transition-all\"\n                  style={{\n                    backgroundColor: '#e5e7eb',\n                    color: '#374151',\n                    borderRadius: 'var(--theme-radius)',\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":11950},"replit.md":{"content":"# Property Management System - Replit Setup\n\n## Overview\nA comprehensive property management system for landlords, caretakers, and tenants in Kenya. Built with Flask backend, React frontend, and SQLite database. Handles rent collection, tenant management, M-PESA payment integration, automated SMS notifications, and lease tracking.\n\n## Current State\n **Production-Ready System**\n- Full-stack application running successfully on Replit\n- Frontend: React + Vite on port 5000 (exposed to web)\n- Backend: Flask API on port 8000 (internal)\n- PostgreSQL database initialized with sample data\n- All dependencies installed (Python 3.11 + Node.js 20)\n- Workflow configured and auto-starts on launch\n- Professional UI with Font Awesome icons\n- Three-theme system (Formal, Dark, Friendly)\n- Messaging templates display professionally (no raw placeholders visible)\n- M-Pesa and SMS integrations ready for credentials\n\n## Recent Changes (November 9, 2025)\n\n### Migration to Replit Environment\n-  Migrated from SQLite to PostgreSQL database\n-  Configured DATABASE_URL and SESSION_SECRET environment variables\n-  Updated backend config to use PostgreSQL with connection pooling\n-  Fixed backend to run on port 8000 (localhost)\n-  Frontend runs on port 5000 with Vite proxy to backend\n-  Installed all Python and Node.js dependencies\n-  Created unified startup script (start_all.sh)\n-  Configured deployment for Autoscale with Gunicorn\n\n### UI Improvements\n-  **Added Professional Icons** (Font Awesome)\n  - Replaced text-based logo with building icon\n  - Professional icon-based design throughout\n-  **Enhanced Theme System** (Formal, Dark, Friendly)\n  - Added Dark theme with navy blue background\n  - Professional theme toggle button with icons (sun/moon/half-circle)\n  - Three-way theme rotation: Formal  Dark  Friendly  Formal\n  - Theme Context with localStorage persistence\n  - All pages enhanced with theme-aware styling\n\n### Backend Configuration\n-  M-Pesa integration configured (ready for API credentials)\n-  SMS/Twilio integration configured (ready for API credentials)\n  - Note: User dismissed Replit Twilio integration, using manual configuration\n  - Backend supports both Twilio and console-based SMS providers\n\n## Project Architecture\n\n### Backend (`/backend`)\n- Framework: Flask 3.0.0\n- Database: PostgreSQL (Neon - via DATABASE_URL)\n- API Port: 8000 (localhost only)\n- Models: Users, Tenants, Payments, Templates, SMSLogs, Alerts\n- Security: RBAC with role-based decorators\n- Session Secret: Managed via SESSION_SECRET environment variable\n\n### Frontend (`/frontend`)\n- Framework: React 18 + Vite 5\n- Styling: Tailwind CSS 3\n- Port: 5000 (0.0.0.0, proxies /api to backend:8000)\n- Routing: React Router 6\n\n## Login Credentials\n\n**Admin Account:**\n- Username: `admin`\n- Password: `admin123`\n- Role: Super Admin (Property Owner)\n\n**Caretaker Account:**\n- Username: `caretaker`\n- Password: `care123`\n- Role: Caretaker\n\n## Development Workflow\n\n### Starting the Application\nThe workflow \"Property Management System\" auto-starts both servers:\n- Frontend: http://localhost:5000 (visible in Replit webview)\n- Backend API: http://localhost:8000 (internal)\n\n### Reinitialize Database\n```bash\ncd backend\npython init_data.py\n```\n\n### Manual Start (if needed)\n```bash\nbash start_all.sh\n```\n\n## Environment Configuration\n\n### Environment Variables\nThe following are automatically configured by Replit:\n- `DATABASE_URL` - PostgreSQL connection string\n- `SESSION_SECRET` - Flask session secret key\n- `PGHOST`, `PGPORT`, `PGUSER`, `PGPASSWORD`, `PGDATABASE` - PostgreSQL credentials\n\n### Optional Configuration (Add as Replit Secrets when ready)\n\n## How to Enable M-Pesa Payments\n\n**What you'll need:**\n1. Safaricom Daraja API account (https://developer.safaricom.co.ke/)\n2. Your business shortcode\n3. Consumer Key and Consumer Secret\n4. Passkey for Lipa Na M-Pesa Online\n\n**Setup Steps:**\n1. Register for Daraja API at https://developer.safaricom.co.ke/\n2. Create a new app in the Daraja Portal\n3. Get your Consumer Key and Consumer Secret from the app\n4. Get your Business Shortcode and Passkey\n5. Add these secrets in Replit (click the lock icon on the left sidebar):\n   ```\n   MPESA_CONSUMER_KEY=your_consumer_key_from_daraja\n   MPESA_CONSUMER_SECRET=your_consumer_secret_from_daraja\n   MPESA_SHORTCODE=your_business_shortcode\n   MPESA_PASSKEY=your_passkey_from_daraja\n   MPESA_CALLBACK_URL=https://your-replit-url.repl.co/api/mpesa/callback\n   MPESA_ENVIRONMENT=sandbox  (use 'production' when ready)\n   ```\n\n**How it works:**\n- System automatically initiates M-Pesa payment when tenant selects \"M-PESA\" payment method\n- Backend generates STK push to tenant's phone\n- Tenant enters M-Pesa PIN on their phone\n- Callback receives confirmation and updates payment record\n- SMS receipt sent automatically (if SMS is configured)\n\n## How to Enable SMS Notifications\n\n**Option 1: Twilio (Recommended)**\n\n**What you'll need:**\n1. Twilio account (https://www.twilio.com/)\n2. Twilio Account SID\n3. Auth Token\n4. Twilio phone number with SMS capability\n\n**Setup Steps:**\n1. Sign up for Twilio at https://www.twilio.com/try-twilio\n2. Verify your phone number\n3. Get a Twilio phone number (trial gives you one for free)\n4. From Twilio Dashboard, copy your Account SID and Auth Token\n5. Add these secrets in Replit:\n   ```\n   TWILIO_ACCOUNT_SID=your_account_sid\n   TWILIO_AUTH_TOKEN=your_auth_token\n   TWILIO_PHONE_NUMBER=+1234567890  (your Twilio number)\n   SMS_PROVIDER=twilio\n   ```\n\n**Option 2: Console Mode (Testing)**\nIf you don't have Twilio credentials yet, the system logs SMS to console:\n```\nSMS_PROVIDER=console\n```\nThis shows you what would be sent without actually sending SMS.\n\n**How it works:**\n- Payment receipts automatically sent to tenants after payment\n- Rent reminders can be sent from Messaging page\n- Custom messages using templates\n- All SMS logged in database for tracking\n\n## Key Features (MVP Complete)\n\n1. **Dual Theme System** - Switch between Friendly (warm, rounded) and Formal (professional, sharp) themes\n2. **Dashboard** - Real-time rent collection summary with color-coded status\n3. **Tenant Management** - Complete CRUD with global search, enhanced card design\n4. **Payment Processing** - Manual cash/M-PESA entry with auto-calculation, improved table UI\n5. **M-PESA Integration** - Daraja API structure (sandbox ready)\n6. **Messaging System** - SMS templates with placeholders, modern UI\n7. **Alerts & Notifications** - Real-time payment and lease notifications\n8. **Role-Based Access** - Super Admin, Caretaker, Tenant roles\n9. **Mobile-First Design** - Fully responsive across all devices\n\n## Technology Stack\n\n- **Backend**: Flask, SQLAlchemy, Flask-Login, Flask-CORS\n- **Frontend**: React, Vite, React Router, Axios\n- **Styling**: Tailwind CSS\n- **Database**: SQLite (development)\n- **Payment**: M-PESA Daraja API (configured)\n- **Messaging**: Twilio (configurable)\n- **Timezone**: Africa/Nairobi (GMT+3)\n\n## Deployment Notes\n\n### Current Deployment Config\n- Target: Autoscale (stateless)\n- Build: Installs frontend dependencies and builds React app\n- Run: Starts backend with Gunicorn\n\n### Production Considerations\nFor production deployment, the Flask backend needs to be configured to serve the built frontend static files. This can be done by:\n1. Adding static file serving to Flask app\n2. Configuring Flask to serve React build from `/frontend/dist`\n3. Ensuring all API routes are prefixed with `/api`\n\n## Sample Data (Already Initialized)\nThe database has been initialized with:\n- **2 user accounts:**\n  - Admin (username: admin, password: admin123) - Super Admin\n  - Caretaker (username: caretaker, password: care123) - Caretaker role\n- **5 sample tenants:** Jane Wanjiku, Peter Kamau, Mary Njeri, David Ochieng, Grace Akinyi\n  - Units: A101, A102, B201, B202, C301\n  - Rent amounts: KES 15,000 - 22,000\n  - Various lease start/end dates\n- **6 message templates:**\n  - Payment Receipt (Formal & Friendly)\n  - Rent Reminder (Formal & Friendly)\n  - Partial Payment Follow-up (Formal & Friendly)\n  \n**Note:** Templates display with preview text (e.g., \"John Doe\", \"A101\") instead of raw placeholders. The system replaces these with actual values when sending messages.\n\n## User Preferences\n- Clean, modular, scalable architecture\n- Production-ready code quality\n- Comprehensive documentation\n- Mobile-first responsive design\n","size_bytes":8393},"backend/app/services/mpesa_service.py":{"content":"import requests\nfrom flask import current_app\nfrom app.models.tenant import Tenant\nfrom datetime import datetime\nimport base64\n\nclass MPesaService:\n    def __init__(self):\n        self.consumer_key = current_app.config['MPESA_CONSUMER_KEY']\n        self.consumer_secret = current_app.config['MPESA_CONSUMER_SECRET']\n        self.shortcode = current_app.config['MPESA_SHORTCODE']\n        self.passkey = current_app.config['MPESA_PASSKEY']\n        self.callback_url = current_app.config['MPESA_CALLBACK_URL']\n        self.environment = current_app.config['MPESA_ENVIRONMENT']\n        \n        if self.environment == 'sandbox':\n            self.base_url = 'https://sandbox.safaricom.co.ke'\n        else:\n            self.base_url = 'https://api.safaricom.co.ke'\n    \n    def get_access_token(self):\n        url = f'{self.base_url}/oauth/v1/generate?grant_type=client_credentials'\n        \n        try:\n            response = requests.get(url, auth=(self.consumer_key, self.consumer_secret))\n            response.raise_for_status()\n            return response.json().get('access_token')\n        except Exception as e:\n            current_app.logger.error(f'Failed to get M-PESA access token: {str(e)}')\n            return None\n    \n    def initiate_stk_push(self, phone, amount, account_reference):\n        access_token = self.get_access_token()\n        if not access_token:\n            return None\n        \n        timestamp = datetime.now().strftime('%Y%m%d%H%M%S')\n        password = base64.b64encode(\n            f'{self.shortcode}{self.passkey}{timestamp}'.encode()\n        ).decode('utf-8')\n        \n        headers = {'Authorization': f'Bearer {access_token}'}\n        \n        payload = {\n            'BusinessShortCode': self.shortcode,\n            'Password': password,\n            'Timestamp': timestamp,\n            'TransactionType': 'CustomerPayBillOnline',\n            'Amount': int(amount),\n            'PartyA': phone,\n            'PartyB': self.shortcode,\n            'PhoneNumber': phone,\n            'CallBackURL': self.callback_url,\n            'AccountReference': account_reference,\n            'TransactionDesc': 'Rent Payment'\n        }\n        \n        url = f'{self.base_url}/mpesa/stkpush/v1/processrequest'\n        \n        try:\n            response = requests.post(url, json=payload, headers=headers)\n            response.raise_for_status()\n            return response.json().get('CheckoutRequestID')\n        except Exception as e:\n            current_app.logger.error(f'Failed to initiate STK push: {str(e)}')\n            return None\n    \n    def process_callback(self, callback_data):\n        try:\n            result_code = callback_data.get('Body', {}).get('stkCallback', {}).get('ResultCode')\n            \n            if result_code != 0:\n                return None\n            \n            callback_metadata = callback_data.get('Body', {}).get('stkCallback', {}).get('CallbackMetadata', {}).get('Item', [])\n            \n            amount = None\n            phone = None\n            transaction_id = None\n            \n            for item in callback_metadata:\n                if item.get('Name') == 'Amount':\n                    amount = item.get('Value')\n                elif item.get('Name') == 'PhoneNumber':\n                    phone = str(item.get('Value'))\n                elif item.get('Name') == 'MpesaReceiptNumber':\n                    transaction_id = item.get('Value')\n            \n            if not all([amount, phone, transaction_id]):\n                return None\n            \n            tenant = self.match_tenant(phone)\n            \n            return {\n                'amount': amount,\n                'phone': phone,\n                'transaction_id': transaction_id,\n                'tenant': tenant\n            }\n        except Exception as e:\n            current_app.logger.error(f'Failed to process M-PESA callback: {str(e)}')\n            return None\n    \n    def match_tenant(self, phone):\n        normalized_phone = phone.replace('+', '').replace(' ', '')\n        \n        tenants = Tenant.query.filter_by(is_active=True).all()\n        \n        for tenant in tenants:\n            tenant_phone = tenant.phone.replace('+', '').replace(' ', '')\n            if tenant_phone.endswith(normalized_phone[-9:]) or normalized_phone.endswith(tenant_phone[-9:]):\n                return tenant\n        \n        return None\n","size_bytes":4368},"backend/app/services/messaging_service.py":{"content":"from flask import current_app\nfrom app.models.template import Template\nfrom app import db\n\nclass MessagingService:\n    def __init__(self):\n        self.provider = current_app.config.get('SMS_PROVIDER', 'twilio')\n    \n    def send_sms(self, phone, message, recipient_name=''):\n        if self.provider == 'twilio':\n            return self._send_via_twilio(phone, message)\n        else:\n            current_app.logger.info(f'SMS to {phone} ({recipient_name}): {message}')\n            return True\n    \n    def _send_via_twilio(self, phone, message):\n        try:\n            from twilio.rest import Client\n            \n            account_sid = current_app.config.get('TWILIO_ACCOUNT_SID')\n            auth_token = current_app.config.get('TWILIO_AUTH_TOKEN')\n            from_phone = current_app.config.get('TWILIO_PHONE_NUMBER')\n            \n            if not all([account_sid, auth_token, from_phone]):\n                current_app.logger.warning('Twilio credentials not configured. SMS not sent.')\n                return False\n            \n            client = Client(account_sid, auth_token)\n            \n            message = client.messages.create(\n                body=message,\n                from_=from_phone,\n                to=phone\n            )\n            \n            return True\n        except Exception as e:\n            current_app.logger.error(f'Failed to send SMS via Twilio: {str(e)}')\n            return False\n    \n    def send_payment_receipt(self, payment, tenant):\n        template = Template.query.filter_by(\n            category='receipt',\n            theme='formal',\n            is_active=True\n        ).first()\n        \n        if template:\n            message = template.render(\n                tenant_name=tenant.full_name,\n                unit_number=tenant.unit_number,\n                amount=payment.amount,\n                payment_date=payment.payment_date.strftime('%d/%m/%Y'),\n                remaining_amount=payment.remaining_amount,\n                transaction_reference=payment.transaction_reference or 'N/A'\n            )\n        else:\n            message = f'Receipt: Payment of KES {payment.amount} received for Unit {tenant.unit_number} on {payment.payment_date.strftime(\"%d/%m/%Y\")}.'\n            if payment.remaining_amount > 0:\n                message += f' Remaining balance: KES {payment.remaining_amount}.'\n        \n        return self.send_sms(tenant.phone, message, tenant.full_name)\n    \n    def send_rent_reminder(self, tenant, remaining_amount=None):\n        template = Template.query.filter_by(\n            category='reminder',\n            is_active=True\n        ).first()\n        \n        if template:\n            message = template.render(\n                tenant_name=tenant.full_name,\n                unit_number=tenant.unit_number,\n                remaining_amount=remaining_amount or tenant.expected_rent\n            )\n        else:\n            message = f'Reminder: Rent of KES {remaining_amount or tenant.expected_rent} is due for Unit {tenant.unit_number}.'\n        \n        return self.send_sms(tenant.phone, message, tenant.full_name)\n","size_bytes":3099},"backend/app/routes/messaging_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required, current_user\nfrom app import db\nfrom app.models.template import Template\nfrom app.models.sms_log import SMSLog\nfrom app.models.tenant import Tenant\nfrom app.services.messaging_service import MessagingService\nfrom app.utils.decorators import admin_or_caretaker_required, admin_required\n\nbp = Blueprint('messaging', __name__, url_prefix='/api/messaging')\n\n@bp.route('/templates', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_templates():\n    category = request.args.get('category')\n    theme = request.args.get('theme')\n    \n    query = Template.query.filter_by(is_active=True)\n    \n    if category:\n        query = query.filter_by(category=category)\n    if theme:\n        query = query.filter_by(theme=theme)\n    \n    templates = query.all()\n    return jsonify({'templates': [t.to_dict() for t in templates]}), 200\n\n@bp.route('/templates', methods=['POST'])\n@login_required\n@admin_required\ndef create_template():\n    data = request.get_json()\n    \n    template = Template(\n        name=data['name'],\n        category=data['category'],\n        theme=data['theme'],\n        content=data['content']\n    )\n    \n    db.session.add(template)\n    db.session.commit()\n    \n    return jsonify({'message': 'Template created successfully', 'template': template.to_dict()}), 201\n\n@bp.route('/send-sms', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef send_sms():\n    data = request.get_json()\n    \n    tenant = Tenant.query.get_or_404(data['tenant_id'])\n    \n    if 'template_id' in data:\n        template = Template.query.get_or_404(data['template_id'])\n        message = template.render(\n            tenant_name=tenant.full_name,\n            unit_number=tenant.unit_number,\n            **data.get('placeholders', {})\n        )\n    else:\n        message = data['message']\n    \n    messaging_service = MessagingService()\n    success = messaging_service.send_sms(tenant.phone, message, tenant.full_name)\n    \n    sms_log = SMSLog(\n        recipient_phone=tenant.phone,\n        recipient_name=tenant.full_name,\n        message=message,\n        message_type=data.get('message_type', 'manual'),\n        status='sent' if success else 'failed',\n        sent_by=current_user.id\n    )\n    db.session.add(sms_log)\n    db.session.commit()\n    \n    if success:\n        return jsonify({'message': 'SMS sent successfully'}), 200\n    \n    return jsonify({'error': 'Failed to send SMS'}), 500\n\n@bp.route('/sms-logs', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_sms_logs():\n    logs = SMSLog.query.order_by(SMSLog.sent_at.desc()).limit(100).all()\n    return jsonify({'sms_logs': [log.to_dict() for log in logs]}), 200\n","size_bytes":2745},"frontend/src/pages/Login.jsx":{"content":"import { useState } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Login({ onLogin }) {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n  const { theme } = useTheme()\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    setError('')\n    setLoading(true)\n\n    try {\n      const response = await api.post('/auth/login', { username, password })\n      onLogin(response.data.user)\n    } catch (err) {\n      setError(err.response?.data?.error || 'Login failed')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div \n      className=\"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 transition-colors duration-300\"\n      style={{ backgroundColor: 'var(--theme-background)' }}\n    >\n      <div className=\"max-w-md w-full space-y-8\">\n        <div className=\"text-center\">\n          <div className=\"flex justify-center mb-4\">\n            <div \n              className=\"h-20 w-20 flex items-center justify-center text-white text-3xl\"\n              style={{\n                backgroundColor: 'var(--theme-primary)',\n                borderRadius: 'var(--theme-radius)',\n              }}\n            >\n              <i className=\"fas fa-building\"></i>\n            </div>\n          </div>\n          <h2 className=\"text-4xl font-extrabold\" style={{ color: 'var(--theme-text)' }}>\n            Property Management\n          </h2>\n          <p className=\"mt-3 text-lg\" style={{ color: 'var(--theme-text-secondary)' }}>\n            Sign in to your account\n          </p>\n        </div>\n        <form className=\"mt-8 space-y-6 theme-card p-8\" onSubmit={handleSubmit}>\n          {error && (\n            <div \n              className=\"px-4 py-3 border-2\"\n              style={{\n                backgroundColor: theme === 'friendly' ? '#fef2f2' : '#fee2e2',\n                borderColor: theme === 'friendly' ? '#f87171' : '#dc2626',\n                color: theme === 'friendly' ? '#991b1b' : '#7f1d1d',\n                borderRadius: 'var(--theme-radius)',\n              }}\n            >\n              {error}\n            </div>\n          )}\n          <div className=\"space-y-5\">\n            <div>\n              <label htmlFor=\"username\" className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>\n                Username\n              </label>\n              <input\n                id=\"username\"\n                name=\"username\"\n                type=\"text\"\n                required\n                className=\"appearance-none relative block w-full px-4 py-3 border-2 focus:outline-none focus:ring-0 transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                placeholder={theme === 'friendly' ? 'Enter your username' : 'Enter your username'}\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n              />\n            </div>\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>\n                Password\n              </label>\n              <input\n                id=\"password\"\n                name=\"password\"\n                type=\"password\"\n                required\n                className=\"appearance-none relative block w-full px-4 py-3 border-2 focus:outline-none focus:ring-0 transition-all\"\n                style={{\n                  borderColor: 'var(--theme-border)',\n                  borderRadius: 'var(--theme-radius)',\n                  color: 'var(--theme-text)',\n                }}\n                placeholder={theme === 'friendly' ? 'Enter your password' : 'Enter your password'}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n              />\n            </div>\n          </div>\n\n          <div>\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"theme-button w-full py-4 font-semibold text-lg disabled:opacity-50\"\n            >\n              {loading ? 'Signing in...' : 'Sign In'}\n            </button>\n          </div>\n        </form>\n        <div className=\"text-center mt-6\">\n          <p className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>\n            {theme === 'friendly' ? 'Demo: admin/admin123 or caretaker/care123' : 'Demo: admin/admin123 or caretaker/care123'}\n          </p>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":4739},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":96},"frontend/src/main.jsx":{"content":"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport './index.css'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)\n","size_bytes":231},"start_all.sh":{"content":"#!/bin/bash\n\necho \"Starting Property Management System...\"\n\npython backend/run.py &\nBACKEND_PID=$!\n\ncd frontend && npm run dev &\nFRONTEND_PID=$!\n\nwait $BACKEND_PID $FRONTEND_PID\n","size_bytes":178},"backend/app/models/sms_log.py":{"content":"from app import db\nfrom datetime import datetime\nimport pytz\n\nclass SMSLog(db.Model):\n    __tablename__ = 'sms_logs'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    recipient_phone = db.Column(db.String(20), nullable=False)\n    recipient_name = db.Column(db.String(120))\n    message = db.Column(db.Text, nullable=False)\n    message_type = db.Column(db.String(50))\n    status = db.Column(db.String(20), default='pending')\n    sent_by = db.Column(db.Integer, db.ForeignKey('users.id'))\n    sent_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'recipient_phone': self.recipient_phone,\n            'recipient_name': self.recipient_name,\n            'message': self.message,\n            'message_type': self.message_type,\n            'status': self.status,\n            'sent_by': self.sent_by,\n            'sent_at': self.sent_at.isoformat() if self.sent_at else None\n        }\n","size_bytes":1010},"frontend/vite.config.js":{"content":"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    host: '0.0.0.0',\n    port: 5000,\n    strictPort: true,\n    proxy: {\n      '/api': {\n        target: 'http://localhost:8000',\n        changeOrigin: true,\n      }\n    }\n  }\n})\n","size_bytes":320},"backend_backup_20251109_155046/payment_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom flask_login import login_required, current_user\nfrom app import db\nfrom app.models.payment import Payment\nfrom app.models.tenant import Tenant\nfrom app.models.alert import Alert\nfrom app.services.messaging_service import MessagingService\nfrom app.utils.decorators import admin_or_caretaker_required\nfrom datetime import datetime\n\nbp = Blueprint('payments', __name__, url_prefix='/api/payments')\n\n@bp.route('', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_payments():\n    tenant_id = request.args.get('tenant_id')\n    \n    query = Payment.query\n    if tenant_id:\n        query = query.filter_by(tenant_id=tenant_id)\n    \n    payments = query.order_by(Payment.payment_date.desc()).all()\n    return jsonify({'payments': [p.to_dict() for p in payments]}), 200\n\n@bp.route('/<int:payment_id>', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_payment(payment_id):\n    payment = Payment.query.get_or_404(payment_id)\n    return jsonify({'payment': payment.to_dict()}), 200\n\n@bp.route('', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef create_payment():\n    data = request.get_json()\n    \n    tenant = Tenant.query.get_or_404(data['tenant_id'])\n    \n    payment = Payment(\n        tenant_id=data['tenant_id'],\n        amount=data['amount'],\n        payment_date=datetime.fromisoformat(data['payment_date']).date(),\n        payment_method=data['payment_method'],\n        transaction_reference=data.get('transaction_reference', ''),\n        notes=data.get('notes', ''),\n        logged_by=current_user.id\n    )\n    \n    payment.calculate_status(tenant.expected_rent)\n    \n    db.session.add(payment)\n    \n    alert = Alert(\n        alert_type='payment_logged',\n        message=f'Payment of KES {payment.amount} logged for {tenant.full_name} - Unit {tenant.unit_number}',\n        severity='info',\n        related_tenant_id=tenant.id,\n        related_payment_id=payment.id\n    )\n    db.session.add(alert)\n    \n    db.session.commit()\n    \n    if data.get('send_receipt', False):\n        messaging_service = MessagingService()\n        messaging_service.send_payment_receipt(payment, tenant)\n    \n    return jsonify({'message': 'Payment logged successfully', 'payment': payment.to_dict()}), 201\n\n@bp.route('/<int:payment_id>/send-receipt', methods=['POST'])\n@login_required\n@admin_or_caretaker_required\ndef send_receipt(payment_id):\n    payment = Payment.query.get_or_404(payment_id)\n    tenant = Tenant.query.get(payment.tenant_id)\n    \n    messaging_service = MessagingService()\n    success = messaging_service.send_payment_receipt(payment, tenant)\n    \n    if success:\n        payment.receipt_sent = True\n        db.session.commit()\n        return jsonify({'message': 'Receipt sent successfully'}), 200\n    \n    return jsonify({'error': 'Failed to send receipt'}), 500\n\n@bp.route('/audit-trail', methods=['GET'])\n@login_required\n@admin_or_caretaker_required\ndef get_audit_trail():\n    payments = Payment.query.order_by(Payment.created_at.desc()).all()\n    \n    audit_data = []\n    for payment in payments:\n        tenant = Tenant.query.get(payment.tenant_id)\n        audit_data.append({\n            **payment.to_dict(),\n            'tenant_name': tenant.full_name if tenant else 'Unknown',\n            'unit_number': tenant.unit_number if tenant else 'Unknown'\n        })\n    \n    return jsonify({'audit_trail': audit_data}), 200\n","size_bytes":3434},"backend/app/models/template.py":{"content":"from app import db\nfrom datetime import datetime\nimport pytz\n\nclass Template(db.Model):\n    __tablename__ = 'templates'\n    \n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    category = db.Column(db.String(50), nullable=False)\n    theme = db.Column(db.String(20), nullable=False)\n    content = db.Column(db.Text, nullable=False)\n    is_active = db.Column(db.Boolean, default=True)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(pytz.timezone('Africa/Nairobi')), onupdate=lambda: datetime.now(pytz.timezone('Africa/Nairobi')))\n    \n    def render(self, **kwargs):\n        content = self.content\n        for key, value in kwargs.items():\n            placeholder = '{' + key + '}'\n            content = content.replace(placeholder, str(value))\n        return content\n    \n    def to_dict(self):\n        return {\n            'id': self.id,\n            'name': self.name,\n            'category': self.category,\n            'theme': self.theme,\n            'content': self.content,\n            'is_active': self.is_active,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":1291},"frontend/tailwind.config.js":{"content":"export default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        friendly: {\n          primary: '#f97316',\n          secondary: '#fb923c',\n          accent: '#fbbf24',\n          success: '#34d399',\n          warning: '#fbbf24',\n          danger: '#f87171',\n          background: '#fff7ed',\n          surface: '#ffffff',\n          text: '#78350f',\n          textSecondary: '#9a3412',\n        },\n        formal: {\n          primary: '#1e40af',\n          secondary: '#3b82f6',\n          accent: '#60a5fa',\n          success: '#059669',\n          warning: '#d97706',\n          danger: '#dc2626',\n          background: '#f8fafc',\n          surface: '#ffffff',\n          text: '#1e293b',\n          textSecondary: '#475569',\n        }\n      },\n      borderRadius: {\n        'friendly': '1.5rem',\n        'formal': '0.375rem',\n      },\n      fontFamily: {\n        'friendly': ['Quicksand', 'Rounded', 'sans-serif'],\n        'formal': ['Inter', 'Helvetica', 'Arial', 'sans-serif'],\n      },\n      boxShadow: {\n        'friendly': '0 10px 25px -5px rgba(249, 115, 22, 0.15), 0 8px 10px -6px rgba(251, 146, 60, 0.1)',\n        'formal': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)',\n      }\n    },\n  },\n  plugins: [],\n}\n","size_bytes":1304},"backend/app/routes/auth_routes.py":{"content":"from flask import Blueprint, request, jsonify, session\nfrom flask_login import login_user, logout_user, login_required, current_user\nfrom app import db\nfrom app.models.user import User\nfrom app.utils.decorators import admin_required\n\nbp = Blueprint('auth', __name__, url_prefix='/api/auth')\n\n@bp.route('/register', methods=['POST'])\n@login_required\n@admin_required\ndef register():\n    data = request.get_json()\n    \n    if User.query.filter_by(username=data['username']).first():\n        return jsonify({'error': 'Username already exists'}), 400\n    \n    if User.query.filter_by(email=data['email']).first():\n        return jsonify({'error': 'Email already exists'}), 400\n    \n    allowed_roles = ['super_admin', 'caretaker', 'tenant']\n    role = data.get('role', 'tenant')\n    if role not in allowed_roles:\n        return jsonify({'error': 'Invalid role'}), 400\n    \n    user = User(\n        username=data['username'],\n        email=data['email'],\n        role=role,\n        phone=data.get('phone', ''),\n        full_name=data.get('full_name', '')\n    )\n    user.set_password(data['password'])\n    \n    db.session.add(user)\n    db.session.commit()\n    \n    return jsonify({'message': 'User created successfully', 'user': user.to_dict()}), 201\n\n@bp.route('/login', methods=['POST'])\ndef login():\n    data = request.get_json()\n    \n    user = User.query.filter_by(username=data['username']).first()\n    \n    if user and user.check_password(data['password']):\n        if not user.is_active:\n            return jsonify({'error': 'Account has been deactivated'}), 403\n        login_user(user, remember=True)\n        return jsonify({'message': 'Login successful', 'user': user.to_dict()}), 200\n    \n    return jsonify({'error': 'Invalid credentials'}), 401\n\n@bp.route('/logout', methods=['POST'])\n@login_required\ndef logout():\n    logout_user()\n    return jsonify({'message': 'Logged out successfully'}), 200\n\n@bp.route('/current-user', methods=['GET'])\n@login_required\ndef get_current_user():\n    return jsonify({'user': current_user.to_dict()}), 200\n\n@bp.route('/check-session', methods=['GET'])\ndef check_session():\n    if current_user.is_authenticated:\n        return jsonify({'authenticated': True, 'user': current_user.to_dict()}), 200\n    return jsonify({'authenticated': False}), 200\n\n@bp.route('/users', methods=['GET'])\n@login_required\n@admin_required\ndef get_users():\n    users = User.query.all()\n    return jsonify({'users': [u.to_dict() for u in users]}), 200\n\n@bp.route('/users/<int:user_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef update_user(user_id):\n    user = User.query.get_or_404(user_id)\n    data = request.get_json()\n    \n    if 'username' in data and data['username'] != user.username:\n        if User.query.filter_by(username=data['username']).first():\n            return jsonify({'error': 'Username already exists'}), 400\n        user.username = data['username']\n    \n    if 'email' in data and data['email'] != user.email:\n        if User.query.filter_by(email=data['email']).first():\n            return jsonify({'error': 'Email already exists'}), 400\n        user.email = data['email']\n    \n    if 'role' in data:\n        allowed_roles = ['super_admin', 'caretaker', 'tenant']\n        if data['role'] in allowed_roles:\n            user.role = data['role']\n    \n    if 'phone' in data:\n        user.phone = data['phone']\n    \n    if 'full_name' in data:\n        user.full_name = data['full_name']\n    \n    if 'password' in data and data['password']:\n        user.set_password(data['password'])\n    \n    db.session.commit()\n    return jsonify({'message': 'User updated successfully', 'user': user.to_dict()}), 200\n\n@bp.route('/users/<int:user_id>/toggle-active', methods=['POST'])\n@login_required\n@admin_required\ndef toggle_user_active(user_id):\n    user = User.query.get_or_404(user_id)\n    \n    if user.id == current_user.id:\n        return jsonify({'error': 'Cannot deactivate your own account'}), 400\n    \n    user.is_active = not user.is_active\n    db.session.commit()\n    \n    status = 'activated' if user.is_active else 'deactivated'\n    return jsonify({'message': f'User {status} successfully', 'user': user.to_dict()}), 200\n","size_bytes":4169},"frontend/src/components/ThemeToggle.jsx":{"content":"import { useTheme } from '../context/ThemeContext'\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme()\n\n  const getThemeIcon = () => {\n    switch(theme) {\n      case 'dark':\n        return <i className=\"fas fa-moon\"></i>\n      case 'friendly':\n        return <i className=\"fas fa-sun\"></i>\n      default:\n        return <i className=\"fas fa-circle-half-stroke\"></i>\n    }\n  }\n\n  const getThemeColor = () => {\n    switch(theme) {\n      case 'dark':\n        return '#1e293b'\n      case 'friendly':\n        return '#f97316'\n      default:\n        return '#3b82f6'\n    }\n  }\n\n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"flex items-center justify-center h-10 w-10 rounded-lg transition-all duration-200 focus:outline-none hover:opacity-80\"\n      style={{\n        backgroundColor: getThemeColor(),\n        color: 'white',\n      }}\n      title={`Current theme: ${theme}`}\n      aria-label=\"Toggle theme\"\n    >\n      {getThemeIcon()}\n    </button>\n  )\n}\n","size_bytes":1003},"frontend/src/context/ThemeContext.jsx":{"content":"import { createContext, useContext, useState, useEffect } from 'react'\n\nconst ThemeContext = createContext()\n\nexport const useTheme = () => {\n  const context = useContext(ThemeContext)\n  if (!context) {\n    throw new Error('useTheme must be used within ThemeProvider')\n  }\n  return context\n}\n\nexport const ThemeProvider = ({ children }) => {\n  const [theme, setTheme] = useState(() => {\n    const savedTheme = localStorage.getItem('app-theme')\n    return savedTheme || 'formal'\n  })\n\n  useEffect(() => {\n    localStorage.setItem('app-theme', theme)\n    document.documentElement.setAttribute('data-theme', theme)\n  }, [theme])\n\n  const toggleTheme = () => {\n    setTheme(prev => {\n      if (prev === 'formal') return 'dark'\n      if (prev === 'dark') return 'friendly'\n      return 'formal'\n    })\n  }\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  )\n}\n","size_bytes":924},"frontend/src/pages/Users.jsx":{"content":"import { useState, useEffect } from 'react'\nimport { useTheme } from '../context/ThemeContext'\nimport api from '../services/api'\n\nexport default function Users() {\n  const [users, setUsers] = useState([])\n  const [showModal, setShowModal] = useState(false)\n  const [editingUser, setEditingUser] = useState(null)\n  const { theme } = useTheme()\n  const [formData, setFormData] = useState({\n    username: '',\n    email: '',\n    password: '',\n    role: 'caretaker',\n    phone: '',\n    full_name: ''\n  })\n\n  useEffect(() => {\n    fetchUsers()\n  }, [])\n\n  const fetchUsers = async () => {\n    try {\n      const response = await api.get('/auth/users')\n      setUsers(response.data.users)\n    } catch (error) {\n      console.error('Failed to fetch users:', error)\n    }\n  }\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    try {\n      if (editingUser) {\n        await api.put(`/auth/users/${editingUser.id}`, formData)\n      } else {\n        await api.post('/auth/register', formData)\n      }\n      setShowModal(false)\n      setEditingUser(null)\n      setFormData({\n        username: '',\n        email: '',\n        password: '',\n        role: 'caretaker',\n        phone: '',\n        full_name: ''\n      })\n      fetchUsers()\n    } catch (error) {\n      console.error('Failed to save user:', error)\n      alert(error.response?.data?.error || 'Failed to save user')\n    }\n  }\n\n  const handleEdit = (user) => {\n    setEditingUser(user)\n    setFormData({\n      username: user.username,\n      email: user.email,\n      password: '',\n      role: user.role,\n      phone: user.phone || '',\n      full_name: user.full_name || ''\n    })\n    setShowModal(true)\n  }\n\n  const handleToggleActive = async (userId) => {\n    try {\n      await api.post(`/auth/users/${userId}/toggle-active`)\n      fetchUsers()\n    } catch (error) {\n      alert(error.response?.data?.error || 'Failed to update user status')\n    }\n  }\n\n  const getRoleBadgeColor = (role) => {\n    switch(role) {\n      case 'super_admin':\n        return { bg: '#dc2626', label: 'Admin' }\n      case 'caretaker':\n        return { bg: '#3b82f6', label: 'Caretaker' }\n      case 'tenant':\n        return { bg: '#6b7280', label: 'Tenant' }\n      default:\n        return { bg: '#9ca3af', label: role }\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-3xl font-bold\" style={{ color: 'var(--theme-text)' }}>\n          <i className=\"fas fa-users mr-3\"></i>\n          User Management\n        </h1>\n        <button\n          onClick={() => {\n            setEditingUser(null)\n            setFormData({\n              username: '',\n              email: '',\n              password: '',\n              role: 'caretaker',\n              phone: '',\n              full_name: ''\n            })\n            setShowModal(true)\n          }}\n          className=\"theme-button px-4 py-2 font-medium flex items-center space-x-2\"\n        >\n          <i className=\"fas fa-plus\"></i>\n          <span>Add User</span>\n        </button>\n      </div>\n\n      <div className=\"theme-card overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n            <thead>\n              <tr style={{ backgroundColor: theme === 'friendly' ? '#fed7aa' : '#e2e8f0' }}>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>User</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Contact</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Role</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Status</th>\n                <th className=\"px-6 py-3 text-left text-xs font-semibold uppercase\" style={{ color: 'var(--theme-text)' }}>Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y\" style={{ borderColor: 'var(--theme-border-light)' }}>\n              {users.map((user) => {\n                const roleBadge = getRoleBadgeColor(user.role)\n                return (\n                  <tr key={user.id} className=\"hover:bg-gray-50 transition-colors\">\n                    <td className=\"px-6 py-4\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"h-10 w-10 rounded-full flex items-center justify-center text-white font-semibold\" style={{ backgroundColor: 'var(--theme-primary)' }}>\n                          {user.full_name ? user.full_name.charAt(0).toUpperCase() : user.username.charAt(0).toUpperCase()}\n                        </div>\n                        <div>\n                          <div className=\"font-semibold\" style={{ color: 'var(--theme-text)' }}>{user.full_name || user.username}</div>\n                          <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>@{user.username}</div>\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"text-sm\" style={{ color: 'var(--theme-text)' }}>{user.email}</div>\n                      <div className=\"text-sm\" style={{ color: 'var(--theme-text-secondary)' }}>{user.phone || '-'}</div>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <span className=\"px-3 py-1 text-xs font-semibold text-white rounded-full\" style={{ backgroundColor: roleBadge.bg }}>\n                        {roleBadge.label}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <span \n                        className=\"px-3 py-1 text-xs font-semibold text-white rounded-full\"\n                        style={{ backgroundColor: user.is_active ? '#10b981' : '#9ca3af' }}\n                      >\n                        {user.is_active ? 'Active' : 'Inactive'}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4\">\n                      <div className=\"flex space-x-2\">\n                        <button\n                          onClick={() => handleEdit(user)}\n                          className=\"text-sm px-3 py-1 rounded hover:opacity-80 transition-opacity\"\n                          style={{ backgroundColor: 'var(--theme-primary)', color: 'white' }}\n                        >\n                          <i className=\"fas fa-edit mr-1\"></i>\n                          Edit\n                        </button>\n                        <button\n                          onClick={() => handleToggleActive(user.id)}\n                          className=\"text-sm px-3 py-1 rounded hover:opacity-80 transition-opacity\"\n                          style={{ backgroundColor: user.is_active ? '#6b7280' : '#10b981', color: 'white' }}\n                        >\n                          <i className={`fas fa-${user.is_active ? 'ban' : 'check'} mr-1`}></i>\n                          {user.is_active ? 'Deactivate' : 'Activate'}\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                )\n              })}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n          <div className=\"theme-card max-w-md w-full max-h-screen overflow-y-auto p-6\">\n            <h2 className=\"text-2xl font-bold mb-6\" style={{ color: 'var(--theme-text)' }}>\n              {editingUser ? 'Edit User' : 'Add New User'}\n            </h2>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Full Name</label>\n                <input\n                  type=\"text\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.full_name}\n                  onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Username</label>\n                <input\n                  type=\"text\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.username}\n                  onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Email</label>\n                <input\n                  type=\"email\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Phone</label>\n                <input\n                  type=\"tel\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  placeholder=\"+254712345678\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>Role</label>\n                <select\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.role}\n                  onChange={(e) => setFormData({ ...formData, role: e.target.value })}\n                  required\n                >\n                  <option value=\"caretaker\">Caretaker</option>\n                  <option value=\"tenant\">Tenant</option>\n                  <option value=\"super_admin\">Super Admin</option>\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-2\" style={{ color: 'var(--theme-text)' }}>\n                  Password {editingUser && '(leave blank to keep current)'}\n                </label>\n                <input\n                  type=\"password\"\n                  className=\"w-full px-4 py-3 border-2 focus:outline-none transition-all\"\n                  style={{\n                    borderColor: 'var(--theme-border)',\n                    borderRadius: 'var(--theme-radius)',\n                    color: 'var(--theme-text)',\n                  }}\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  required={!editingUser}\n                />\n              </div>\n              <div className=\"flex space-x-3 pt-4\">\n                <button\n                  type=\"submit\"\n                  className=\"flex-1 theme-button px-4 py-3 font-medium\"\n                >\n                  <i className=\"fas fa-save mr-2\"></i>\n                  {editingUser ? 'Update User' : 'Create User'}\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setShowModal(false)\n                    setEditingUser(null)\n                  }}\n                  className=\"flex-1 px-4 py-3 font-medium transition-all\"\n                  style={{\n                    backgroundColor: '#e5e7eb',\n                    color: '#374151',\n                    borderRadius: 'var(--theme-radius)',\n                  }}\n                >\n                  Cancel\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":13336}},"version":2}